
<!doctype html>
<html lang="en" class="no-js">
  <head>
    
      <meta charset="utf-8">
      <meta name="viewport" content="width=device-width,initial-scale=1">
      
      
      
      
        <link rel="prev" href="../..">
      
      
        <link rel="next" href="../thermo/">
      
      
      <link rel="icon" href="../../assets/images/favicon.png">
      <meta name="generator" content="mkdocs-1.6.0, mkdocs-material-9.5.31">
    
    
      
        <title>Chunk - Thermotar Docs</title>
      
    
    
      <link rel="stylesheet" href="../../assets/stylesheets/main.3cba04c6.min.css">
      
        
        <link rel="stylesheet" href="../../assets/stylesheets/palette.06af60db.min.css">
      
      


    
    
      
    
    
      
        
        
        <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
        <link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Roboto:300,300i,400,400i,700,700i%7CRoboto+Mono:400,400i,700,700i&display=fallback">
        <style>:root{--md-text-font:"Roboto";--md-code-font:"Roboto Mono"}</style>
      
    
    
      <link rel="stylesheet" href="../../assets/_mkdocstrings.css">
    
      <link rel="stylesheet" href="../../stylesheets/extra.css">
    
    <script>__md_scope=new URL("../..",location),__md_hash=e=>[...e].reduce((e,_)=>(e<<5)-e+_.charCodeAt(0),0),__md_get=(e,_=localStorage,t=__md_scope)=>JSON.parse(_.getItem(t.pathname+"."+e)),__md_set=(e,_,t=localStorage,a=__md_scope)=>{try{t.setItem(a.pathname+"."+e,JSON.stringify(_))}catch(e){}}</script>
    
      

    
    
    
  </head>
  
  
    
    
      
    
    
    
    
    <body dir="ltr" data-md-color-scheme="default" data-md-color-primary="indigo" data-md-color-accent="indigo">
  
    
    <input class="md-toggle" data-md-toggle="drawer" type="checkbox" id="__drawer" autocomplete="off">
    <input class="md-toggle" data-md-toggle="search" type="checkbox" id="__search" autocomplete="off">
    <label class="md-overlay" for="__drawer"></label>
    <div data-md-component="skip">
      
        
        <a href="#chunk" class="md-skip">
          Skip to content
        </a>
      
    </div>
    <div data-md-component="announce">
      
    </div>
    
    
      

  

<header class="md-header md-header--shadow" data-md-component="header">
  <nav class="md-header__inner md-grid" aria-label="Header">
    <a href="../.." title="Thermotar Docs" class="md-header__button md-logo" aria-label="Thermotar Docs" data-md-component="logo">
      
  
  <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M12 8a3 3 0 0 0 3-3 3 3 0 0 0-3-3 3 3 0 0 0-3 3 3 3 0 0 0 3 3m0 3.54C9.64 9.35 6.5 8 3 8v11c3.5 0 6.64 1.35 9 3.54 2.36-2.19 5.5-3.54 9-3.54V8c-3.5 0-6.64 1.35-9 3.54Z"/></svg>

    </a>
    <label class="md-header__button md-icon" for="__drawer">
      
      <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M3 6h18v2H3V6m0 5h18v2H3v-2m0 5h18v2H3v-2Z"/></svg>
    </label>
    <div class="md-header__title" data-md-component="header-title">
      <div class="md-header__ellipsis">
        <div class="md-header__topic">
          <span class="md-ellipsis">
            Thermotar Docs
          </span>
        </div>
        <div class="md-header__topic" data-md-component="header-topic">
          <span class="md-ellipsis">
            
              Chunk
            
          </span>
        </div>
      </div>
    </div>
    
      
        <form class="md-header__option" data-md-component="palette">
  
    
    
    
    <input class="md-option" data-md-color-media="(prefers-color-scheme)" data-md-color-scheme="default" data-md-color-primary="indigo" data-md-color-accent="indigo"  aria-label="Switch to light mode"  type="radio" name="__palette" id="__palette_0">
    
      <label class="md-header__button md-icon" title="Switch to light mode" for="__palette_1" hidden>
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="m14.3 16-.7-2h-3.2l-.7 2H7.8L11 7h2l3.2 9h-1.9M20 8.69V4h-4.69L12 .69 8.69 4H4v4.69L.69 12 4 15.31V20h4.69L12 23.31 15.31 20H20v-4.69L23.31 12 20 8.69m-9.15 3.96h2.3L12 9l-1.15 3.65Z"/></svg>
      </label>
    
  
    
    
    
    <input class="md-option" data-md-color-media="(prefers-color-scheme: light)" data-md-color-scheme="default" data-md-color-primary="red" data-md-color-accent="red"  aria-label="Switch to dark mode"  type="radio" name="__palette" id="__palette_1">
    
      <label class="md-header__button md-icon" title="Switch to dark mode" for="__palette_2" hidden>
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M12 8a4 4 0 0 0-4 4 4 4 0 0 0 4 4 4 4 0 0 0 4-4 4 4 0 0 0-4-4m0 10a6 6 0 0 1-6-6 6 6 0 0 1 6-6 6 6 0 0 1 6 6 6 6 0 0 1-6 6m8-9.31V4h-4.69L12 .69 8.69 4H4v4.69L.69 12 4 15.31V20h4.69L12 23.31 15.31 20H20v-4.69L23.31 12 20 8.69Z"/></svg>
      </label>
    
  
    
    
    
    <input class="md-option" data-md-color-media="(prefers-color-scheme: dark)" data-md-color-scheme="slate" data-md-color-primary="indigo" data-md-color-accent="indigo"  aria-label="Switch to light mode"  type="radio" name="__palette" id="__palette_2">
    
      <label class="md-header__button md-icon" title="Switch to light mode" for="__palette_0" hidden>
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M12 18c-.89 0-1.74-.2-2.5-.55C11.56 16.5 13 14.42 13 12c0-2.42-1.44-4.5-3.5-5.45C10.26 6.2 11.11 6 12 6a6 6 0 0 1 6 6 6 6 0 0 1-6 6m8-9.31V4h-4.69L12 .69 8.69 4H4v4.69L.69 12 4 15.31V20h4.69L12 23.31 15.31 20H20v-4.69L23.31 12 20 8.69Z"/></svg>
      </label>
    
  
</form>
      
    
    
      <script>var media,input,key,value,palette=__md_get("__palette");if(palette&&palette.color){"(prefers-color-scheme)"===palette.color.media&&(media=matchMedia("(prefers-color-scheme: light)"),input=document.querySelector(media.matches?"[data-md-color-media='(prefers-color-scheme: light)']":"[data-md-color-media='(prefers-color-scheme: dark)']"),palette.color.media=input.getAttribute("data-md-color-media"),palette.color.scheme=input.getAttribute("data-md-color-scheme"),palette.color.primary=input.getAttribute("data-md-color-primary"),palette.color.accent=input.getAttribute("data-md-color-accent"));for([key,value]of Object.entries(palette.color))document.body.setAttribute("data-md-color-"+key,value)}</script>
    
    
    
      <label class="md-header__button md-icon" for="__search">
        
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M9.5 3A6.5 6.5 0 0 1 16 9.5c0 1.61-.59 3.09-1.56 4.23l.27.27h.79l5 5-1.5 1.5-5-5v-.79l-.27-.27A6.516 6.516 0 0 1 9.5 16 6.5 6.5 0 0 1 3 9.5 6.5 6.5 0 0 1 9.5 3m0 2C7 5 5 7 5 9.5S7 14 9.5 14 14 12 14 9.5 12 5 9.5 5Z"/></svg>
      </label>
      <div class="md-search" data-md-component="search" role="dialog">
  <label class="md-search__overlay" for="__search"></label>
  <div class="md-search__inner" role="search">
    <form class="md-search__form" name="search">
      <input type="text" class="md-search__input" name="query" aria-label="Search" placeholder="Search" autocapitalize="off" autocorrect="off" autocomplete="off" spellcheck="false" data-md-component="search-query" required>
      <label class="md-search__icon md-icon" for="__search">
        
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M9.5 3A6.5 6.5 0 0 1 16 9.5c0 1.61-.59 3.09-1.56 4.23l.27.27h.79l5 5-1.5 1.5-5-5v-.79l-.27-.27A6.516 6.516 0 0 1 9.5 16 6.5 6.5 0 0 1 3 9.5 6.5 6.5 0 0 1 9.5 3m0 2C7 5 5 7 5 9.5S7 14 9.5 14 14 12 14 9.5 12 5 9.5 5Z"/></svg>
        
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M20 11v2H8l5.5 5.5-1.42 1.42L4.16 12l7.92-7.92L13.5 5.5 8 11h12Z"/></svg>
      </label>
      <nav class="md-search__options" aria-label="Search">
        
        <button type="reset" class="md-search__icon md-icon" title="Clear" aria-label="Clear" tabindex="-1">
          
          <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M19 6.41 17.59 5 12 10.59 6.41 5 5 6.41 10.59 12 5 17.59 6.41 19 12 13.41 17.59 19 19 17.59 13.41 12 19 6.41Z"/></svg>
        </button>
      </nav>
      
    </form>
    <div class="md-search__output">
      <div class="md-search__scrollwrap" tabindex="0" data-md-scrollfix>
        <div class="md-search-result" data-md-component="search-result">
          <div class="md-search-result__meta">
            Initializing search
          </div>
          <ol class="md-search-result__list" role="presentation"></ol>
        </div>
      </div>
    </div>
  </div>
</div>
    
    
  </nav>
  
</header>
    
    <div class="md-container" data-md-component="container">
      
      
        
          
        
      
      <main class="md-main" data-md-component="main">
        <div class="md-main__inner md-grid">
          
            
              
              <div class="md-sidebar md-sidebar--primary" data-md-component="sidebar" data-md-type="navigation" >
                <div class="md-sidebar__scrollwrap">
                  <div class="md-sidebar__inner">
                    



<nav class="md-nav md-nav--primary" aria-label="Navigation" data-md-level="0">
  <label class="md-nav__title" for="__drawer">
    <a href="../.." title="Thermotar Docs" class="md-nav__button md-logo" aria-label="Thermotar Docs" data-md-component="logo">
      
  
  <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M12 8a3 3 0 0 0 3-3 3 3 0 0 0-3-3 3 3 0 0 0-3 3 3 3 0 0 0 3 3m0 3.54C9.64 9.35 6.5 8 3 8v11c3.5 0 6.64 1.35 9 3.54 2.36-2.19 5.5-3.54 9-3.54V8c-3.5 0-6.64 1.35-9 3.54Z"/></svg>

    </a>
    Thermotar Docs
  </label>
  
  <ul class="md-nav__list" data-md-scrollfix>
    
      
      
  
  
  
  
    <li class="md-nav__item">
      <a href="../.." class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Thermotar Docs
  </span>
  

      </a>
    </li>
  

    
      
      
  
  
    
  
  
  
    
    
    
    
    <li class="md-nav__item md-nav__item--active md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_2" checked>
        
          
          <label class="md-nav__link" for="__nav_2" id="__nav_2_label" tabindex="0">
            
  
  <span class="md-ellipsis">
    Reference
  </span>
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="1" aria-labelledby="__nav_2_label" aria-expanded="true">
          <label class="md-nav__title" for="__nav_2">
            <span class="md-nav__icon md-icon"></span>
            Reference
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
    
  
  
  
    <li class="md-nav__item md-nav__item--active">
      
      <input class="md-nav__toggle md-toggle" type="checkbox" id="__toc">
      
      
      
        <label class="md-nav__link md-nav__link--active" for="__toc">
          
  
  <span class="md-ellipsis">
    Chunk
  </span>
  

          <span class="md-nav__icon md-icon"></span>
        </label>
      
      <a href="./" class="md-nav__link md-nav__link--active">
        
  
  <span class="md-ellipsis">
    Chunk
  </span>
  

      </a>
      
        

<nav class="md-nav md-nav--secondary" aria-label="Table of contents">
  
  
  
  
    <label class="md-nav__title" for="__toc">
      <span class="md-nav__icon md-icon"></span>
      Table of contents
    </label>
    <ul class="md-nav__list" data-md-component="toc" data-md-scrollfix>
      
        <li class="md-nav__item">
  <a href="#chunk" class="md-nav__link">
    <span class="md-ellipsis">
      Chunk
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#thermotar.chunk.Chunk" class="md-nav__link">
    <span class="md-ellipsis">
      Chunk
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#thermotar.chunk.Chunk.centered" class="md-nav__link">
    <span class="md-ellipsis">
      centered
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#thermotar.chunk.Chunk.__init__" class="md-nav__link">
    <span class="md-ellipsis">
      __init__
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#thermotar.chunk.Chunk.center" class="md-nav__link">
    <span class="md-ellipsis">
      center
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#thermotar.chunk.Chunk.centre" class="md-nav__link">
    <span class="md-ellipsis">
      centre
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#thermotar.chunk.Chunk.centre_series" class="md-nav__link">
    <span class="md-ellipsis">
      centre_series
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#thermotar.chunk.Chunk.choose_coordinate" class="md-nav__link">
    <span class="md-ellipsis">
      choose_coordinate
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#thermotar.chunk.Chunk.create_chunk" class="md-nav__link">
    <span class="md-ellipsis">
      create_chunk
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#thermotar.chunk.Chunk.fold" class="md-nav__link">
    <span class="md-ellipsis">
      fold
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#thermotar.chunk.Chunk.fold_and_ave" class="md-nav__link">
    <span class="md-ellipsis">
      fold_and_ave
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#thermotar.chunk.Chunk.moment" class="md-nav__link">
    <span class="md-ellipsis">
      moment
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#thermotar.chunk.Chunk.nearest" class="md-nav__link">
    <span class="md-ellipsis">
      nearest
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#thermotar.chunk.Chunk.parity" class="md-nav__link">
    <span class="md-ellipsis">
      parity
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#thermotar.chunk.Chunk.prop_grad" class="md-nav__link">
    <span class="md-ellipsis">
      prop_grad
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#thermotar.chunk.Chunk.raise_columns" class="md-nav__link">
    <span class="md-ellipsis">
      raise_columns
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#thermotar.chunk.Chunk.rebin" class="md-nav__link">
    <span class="md-ellipsis">
      rebin
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#multichunk" class="md-nav__link">
    <span class="md-ellipsis">
      MultiChunk
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#thermotar.multichunk.MultiChunk" class="md-nav__link">
    <span class="md-ellipsis">
      MultiChunk
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#thermotar.multichunk.MultiChunk.__init__" class="md-nav__link">
    <span class="md-ellipsis">
      __init__
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#thermotar.multichunk.MultiChunk.thersh_to_nan_return" class="md-nav__link">
    <span class="md-ellipsis">
      thersh_to_nan_return
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#thermotar.multichunk.MultiChunk.thresh_to_nan_inplace" class="md-nav__link">
    <span class="md-ellipsis">
      thresh_to_nan_inplace
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#thermotar.multichunk.MultiChunk.zero_to_nan" class="md-nav__link">
    <span class="md-ellipsis">
      zero_to_nan
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#thermotar.multichunk.MultiChunk.zero_to_nan_return" class="md-nav__link">
    <span class="md-ellipsis">
      zero_to_nan_return
    </span>
  </a>
  
</li>
      
    </ul>
  
</nav>
      
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../thermo/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Thermo
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../interface/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Intersects
  </span>
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

    
      
      
  
  
  
  
    <li class="md-nav__item">
      <a href="../../explanation/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Explanation
  </span>
  

      </a>
    </li>
  

    
      
      
  
  
  
  
    <li class="md-nav__item">
      <a href="../../tutorials/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Tutorials
  </span>
  

      </a>
    </li>
  

    
      
      
  
  
  
  
    <li class="md-nav__item">
      <a href="../../how-to-guides/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    How-To Guides
  </span>
  

      </a>
    </li>
  

    
  </ul>
</nav>
                  </div>
                </div>
              </div>
            
            
              
              <div class="md-sidebar md-sidebar--secondary" data-md-component="sidebar" data-md-type="toc" >
                <div class="md-sidebar__scrollwrap">
                  <div class="md-sidebar__inner">
                    

<nav class="md-nav md-nav--secondary" aria-label="Table of contents">
  
  
  
  
    <label class="md-nav__title" for="__toc">
      <span class="md-nav__icon md-icon"></span>
      Table of contents
    </label>
    <ul class="md-nav__list" data-md-component="toc" data-md-scrollfix>
      
        <li class="md-nav__item">
  <a href="#chunk" class="md-nav__link">
    <span class="md-ellipsis">
      Chunk
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#thermotar.chunk.Chunk" class="md-nav__link">
    <span class="md-ellipsis">
      Chunk
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#thermotar.chunk.Chunk.centered" class="md-nav__link">
    <span class="md-ellipsis">
      centered
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#thermotar.chunk.Chunk.__init__" class="md-nav__link">
    <span class="md-ellipsis">
      __init__
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#thermotar.chunk.Chunk.center" class="md-nav__link">
    <span class="md-ellipsis">
      center
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#thermotar.chunk.Chunk.centre" class="md-nav__link">
    <span class="md-ellipsis">
      centre
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#thermotar.chunk.Chunk.centre_series" class="md-nav__link">
    <span class="md-ellipsis">
      centre_series
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#thermotar.chunk.Chunk.choose_coordinate" class="md-nav__link">
    <span class="md-ellipsis">
      choose_coordinate
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#thermotar.chunk.Chunk.create_chunk" class="md-nav__link">
    <span class="md-ellipsis">
      create_chunk
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#thermotar.chunk.Chunk.fold" class="md-nav__link">
    <span class="md-ellipsis">
      fold
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#thermotar.chunk.Chunk.fold_and_ave" class="md-nav__link">
    <span class="md-ellipsis">
      fold_and_ave
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#thermotar.chunk.Chunk.moment" class="md-nav__link">
    <span class="md-ellipsis">
      moment
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#thermotar.chunk.Chunk.nearest" class="md-nav__link">
    <span class="md-ellipsis">
      nearest
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#thermotar.chunk.Chunk.parity" class="md-nav__link">
    <span class="md-ellipsis">
      parity
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#thermotar.chunk.Chunk.prop_grad" class="md-nav__link">
    <span class="md-ellipsis">
      prop_grad
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#thermotar.chunk.Chunk.raise_columns" class="md-nav__link">
    <span class="md-ellipsis">
      raise_columns
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#thermotar.chunk.Chunk.rebin" class="md-nav__link">
    <span class="md-ellipsis">
      rebin
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#multichunk" class="md-nav__link">
    <span class="md-ellipsis">
      MultiChunk
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#thermotar.multichunk.MultiChunk" class="md-nav__link">
    <span class="md-ellipsis">
      MultiChunk
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#thermotar.multichunk.MultiChunk.__init__" class="md-nav__link">
    <span class="md-ellipsis">
      __init__
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#thermotar.multichunk.MultiChunk.thersh_to_nan_return" class="md-nav__link">
    <span class="md-ellipsis">
      thersh_to_nan_return
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#thermotar.multichunk.MultiChunk.thresh_to_nan_inplace" class="md-nav__link">
    <span class="md-ellipsis">
      thresh_to_nan_inplace
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#thermotar.multichunk.MultiChunk.zero_to_nan" class="md-nav__link">
    <span class="md-ellipsis">
      zero_to_nan
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#thermotar.multichunk.MultiChunk.zero_to_nan_return" class="md-nav__link">
    <span class="md-ellipsis">
      zero_to_nan_return
    </span>
  </a>
  
</li>
      
    </ul>
  
</nav>
                  </div>
                </div>
              </div>
            
          
          
            <div class="md-content" data-md-component="content">
              <article class="md-content__inner md-typeset">
                
                  


  <h1>Chunk</h1>

<h2 id="chunk">Chunk</h2>


<div class="doc doc-object doc-class">



<a id="thermotar.chunk.Chunk"></a>
    <div class="doc doc-contents first">


      <p>Class for Reading output from LAMMPS chunk/ave command.</p>

              <details class="quote">
                <summary>Source code in <code>thermotar/chunk.py</code></summary>
                <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"> 15</span>
<span class="normal"> 16</span>
<span class="normal"> 17</span>
<span class="normal"> 18</span>
<span class="normal"> 19</span>
<span class="normal"> 20</span>
<span class="normal"> 21</span>
<span class="normal"> 22</span>
<span class="normal"> 23</span>
<span class="normal"> 24</span>
<span class="normal"> 25</span>
<span class="normal"> 26</span>
<span class="normal"> 27</span>
<span class="normal"> 28</span>
<span class="normal"> 29</span>
<span class="normal"> 30</span>
<span class="normal"> 31</span>
<span class="normal"> 32</span>
<span class="normal"> 33</span>
<span class="normal"> 34</span>
<span class="normal"> 35</span>
<span class="normal"> 36</span>
<span class="normal"> 37</span>
<span class="normal"> 38</span>
<span class="normal"> 39</span>
<span class="normal"> 40</span>
<span class="normal"> 41</span>
<span class="normal"> 42</span>
<span class="normal"> 43</span>
<span class="normal"> 44</span>
<span class="normal"> 45</span>
<span class="normal"> 46</span>
<span class="normal"> 47</span>
<span class="normal"> 48</span>
<span class="normal"> 49</span>
<span class="normal"> 50</span>
<span class="normal"> 51</span>
<span class="normal"> 52</span>
<span class="normal"> 53</span>
<span class="normal"> 54</span>
<span class="normal"> 55</span>
<span class="normal"> 56</span>
<span class="normal"> 57</span>
<span class="normal"> 58</span>
<span class="normal"> 59</span>
<span class="normal"> 60</span>
<span class="normal"> 61</span>
<span class="normal"> 62</span>
<span class="normal"> 63</span>
<span class="normal"> 64</span>
<span class="normal"> 65</span>
<span class="normal"> 66</span>
<span class="normal"> 67</span>
<span class="normal"> 68</span>
<span class="normal"> 69</span>
<span class="normal"> 70</span>
<span class="normal"> 71</span>
<span class="normal"> 72</span>
<span class="normal"> 73</span>
<span class="normal"> 74</span>
<span class="normal"> 75</span>
<span class="normal"> 76</span>
<span class="normal"> 77</span>
<span class="normal"> 78</span>
<span class="normal"> 79</span>
<span class="normal"> 80</span>
<span class="normal"> 81</span>
<span class="normal"> 82</span>
<span class="normal"> 83</span>
<span class="normal"> 84</span>
<span class="normal"> 85</span>
<span class="normal"> 86</span>
<span class="normal"> 87</span>
<span class="normal"> 88</span>
<span class="normal"> 89</span>
<span class="normal"> 90</span>
<span class="normal"> 91</span>
<span class="normal"> 92</span>
<span class="normal"> 93</span>
<span class="normal"> 94</span>
<span class="normal"> 95</span>
<span class="normal"> 96</span>
<span class="normal"> 97</span>
<span class="normal"> 98</span>
<span class="normal"> 99</span>
<span class="normal">100</span>
<span class="normal">101</span>
<span class="normal">102</span>
<span class="normal">103</span>
<span class="normal">104</span>
<span class="normal">105</span>
<span class="normal">106</span>
<span class="normal">107</span>
<span class="normal">108</span>
<span class="normal">109</span>
<span class="normal">110</span>
<span class="normal">111</span>
<span class="normal">112</span>
<span class="normal">113</span>
<span class="normal">114</span>
<span class="normal">115</span>
<span class="normal">116</span>
<span class="normal">117</span>
<span class="normal">118</span>
<span class="normal">119</span>
<span class="normal">120</span>
<span class="normal">121</span>
<span class="normal">122</span>
<span class="normal">123</span>
<span class="normal">124</span>
<span class="normal">125</span>
<span class="normal">126</span>
<span class="normal">127</span>
<span class="normal">128</span>
<span class="normal">129</span>
<span class="normal">130</span>
<span class="normal">131</span>
<span class="normal">132</span>
<span class="normal">133</span>
<span class="normal">134</span>
<span class="normal">135</span>
<span class="normal">136</span>
<span class="normal">137</span>
<span class="normal">138</span>
<span class="normal">139</span>
<span class="normal">140</span>
<span class="normal">141</span>
<span class="normal">142</span>
<span class="normal">143</span>
<span class="normal">144</span>
<span class="normal">145</span>
<span class="normal">146</span>
<span class="normal">147</span>
<span class="normal">148</span>
<span class="normal">149</span>
<span class="normal">150</span>
<span class="normal">151</span>
<span class="normal">152</span>
<span class="normal">153</span>
<span class="normal">154</span>
<span class="normal">155</span>
<span class="normal">156</span>
<span class="normal">157</span>
<span class="normal">158</span>
<span class="normal">159</span>
<span class="normal">160</span>
<span class="normal">161</span>
<span class="normal">162</span>
<span class="normal">163</span>
<span class="normal">164</span>
<span class="normal">165</span>
<span class="normal">166</span>
<span class="normal">167</span>
<span class="normal">168</span>
<span class="normal">169</span>
<span class="normal">170</span>
<span class="normal">171</span>
<span class="normal">172</span>
<span class="normal">173</span>
<span class="normal">174</span>
<span class="normal">175</span>
<span class="normal">176</span>
<span class="normal">177</span>
<span class="normal">178</span>
<span class="normal">179</span>
<span class="normal">180</span>
<span class="normal">181</span>
<span class="normal">182</span>
<span class="normal">183</span>
<span class="normal">184</span>
<span class="normal">185</span>
<span class="normal">186</span>
<span class="normal">187</span>
<span class="normal">188</span>
<span class="normal">189</span>
<span class="normal">190</span>
<span class="normal">191</span>
<span class="normal">192</span>
<span class="normal">193</span>
<span class="normal">194</span>
<span class="normal">195</span>
<span class="normal">196</span>
<span class="normal">197</span>
<span class="normal">198</span>
<span class="normal">199</span>
<span class="normal">200</span>
<span class="normal">201</span>
<span class="normal">202</span>
<span class="normal">203</span>
<span class="normal">204</span>
<span class="normal">205</span>
<span class="normal">206</span>
<span class="normal">207</span>
<span class="normal">208</span>
<span class="normal">209</span>
<span class="normal">210</span>
<span class="normal">211</span>
<span class="normal">212</span>
<span class="normal">213</span>
<span class="normal">214</span>
<span class="normal">215</span>
<span class="normal">216</span>
<span class="normal">217</span>
<span class="normal">218</span>
<span class="normal">219</span>
<span class="normal">220</span>
<span class="normal">221</span>
<span class="normal">222</span>
<span class="normal">223</span>
<span class="normal">224</span>
<span class="normal">225</span>
<span class="normal">226</span>
<span class="normal">227</span>
<span class="normal">228</span>
<span class="normal">229</span>
<span class="normal">230</span>
<span class="normal">231</span>
<span class="normal">232</span>
<span class="normal">233</span>
<span class="normal">234</span>
<span class="normal">235</span>
<span class="normal">236</span>
<span class="normal">237</span>
<span class="normal">238</span>
<span class="normal">239</span>
<span class="normal">240</span>
<span class="normal">241</span>
<span class="normal">242</span>
<span class="normal">243</span>
<span class="normal">244</span>
<span class="normal">245</span>
<span class="normal">246</span>
<span class="normal">247</span>
<span class="normal">248</span>
<span class="normal">249</span>
<span class="normal">250</span>
<span class="normal">251</span>
<span class="normal">252</span>
<span class="normal">253</span>
<span class="normal">254</span>
<span class="normal">255</span>
<span class="normal">256</span>
<span class="normal">257</span>
<span class="normal">258</span>
<span class="normal">259</span>
<span class="normal">260</span>
<span class="normal">261</span>
<span class="normal">262</span>
<span class="normal">263</span>
<span class="normal">264</span>
<span class="normal">265</span>
<span class="normal">266</span>
<span class="normal">267</span>
<span class="normal">268</span>
<span class="normal">269</span>
<span class="normal">270</span>
<span class="normal">271</span>
<span class="normal">272</span>
<span class="normal">273</span>
<span class="normal">274</span>
<span class="normal">275</span>
<span class="normal">276</span>
<span class="normal">277</span>
<span class="normal">278</span>
<span class="normal">279</span>
<span class="normal">280</span>
<span class="normal">281</span>
<span class="normal">282</span>
<span class="normal">283</span>
<span class="normal">284</span>
<span class="normal">285</span>
<span class="normal">286</span>
<span class="normal">287</span>
<span class="normal">288</span>
<span class="normal">289</span>
<span class="normal">290</span>
<span class="normal">291</span>
<span class="normal">292</span>
<span class="normal">293</span>
<span class="normal">294</span>
<span class="normal">295</span>
<span class="normal">296</span>
<span class="normal">297</span>
<span class="normal">298</span>
<span class="normal">299</span>
<span class="normal">300</span>
<span class="normal">301</span>
<span class="normal">302</span>
<span class="normal">303</span>
<span class="normal">304</span>
<span class="normal">305</span>
<span class="normal">306</span>
<span class="normal">307</span>
<span class="normal">308</span>
<span class="normal">309</span>
<span class="normal">310</span>
<span class="normal">311</span>
<span class="normal">312</span>
<span class="normal">313</span>
<span class="normal">314</span>
<span class="normal">315</span>
<span class="normal">316</span>
<span class="normal">317</span>
<span class="normal">318</span>
<span class="normal">319</span>
<span class="normal">320</span>
<span class="normal">321</span>
<span class="normal">322</span>
<span class="normal">323</span>
<span class="normal">324</span>
<span class="normal">325</span>
<span class="normal">326</span>
<span class="normal">327</span>
<span class="normal">328</span>
<span class="normal">329</span>
<span class="normal">330</span>
<span class="normal">331</span>
<span class="normal">332</span>
<span class="normal">333</span>
<span class="normal">334</span>
<span class="normal">335</span>
<span class="normal">336</span>
<span class="normal">337</span>
<span class="normal">338</span>
<span class="normal">339</span>
<span class="normal">340</span>
<span class="normal">341</span>
<span class="normal">342</span>
<span class="normal">343</span>
<span class="normal">344</span>
<span class="normal">345</span>
<span class="normal">346</span>
<span class="normal">347</span>
<span class="normal">348</span>
<span class="normal">349</span>
<span class="normal">350</span>
<span class="normal">351</span>
<span class="normal">352</span>
<span class="normal">353</span>
<span class="normal">354</span>
<span class="normal">355</span>
<span class="normal">356</span>
<span class="normal">357</span>
<span class="normal">358</span>
<span class="normal">359</span>
<span class="normal">360</span>
<span class="normal">361</span>
<span class="normal">362</span>
<span class="normal">363</span>
<span class="normal">364</span>
<span class="normal">365</span>
<span class="normal">366</span>
<span class="normal">367</span>
<span class="normal">368</span>
<span class="normal">369</span>
<span class="normal">370</span>
<span class="normal">371</span>
<span class="normal">372</span>
<span class="normal">373</span>
<span class="normal">374</span>
<span class="normal">375</span>
<span class="normal">376</span>
<span class="normal">377</span>
<span class="normal">378</span>
<span class="normal">379</span>
<span class="normal">380</span>
<span class="normal">381</span>
<span class="normal">382</span>
<span class="normal">383</span>
<span class="normal">384</span>
<span class="normal">385</span>
<span class="normal">386</span>
<span class="normal">387</span>
<span class="normal">388</span>
<span class="normal">389</span>
<span class="normal">390</span>
<span class="normal">391</span>
<span class="normal">392</span>
<span class="normal">393</span>
<span class="normal">394</span>
<span class="normal">395</span>
<span class="normal">396</span>
<span class="normal">397</span>
<span class="normal">398</span>
<span class="normal">399</span>
<span class="normal">400</span>
<span class="normal">401</span>
<span class="normal">402</span>
<span class="normal">403</span>
<span class="normal">404</span>
<span class="normal">405</span>
<span class="normal">406</span>
<span class="normal">407</span>
<span class="normal">408</span>
<span class="normal">409</span>
<span class="normal">410</span>
<span class="normal">411</span>
<span class="normal">412</span>
<span class="normal">413</span>
<span class="normal">414</span>
<span class="normal">415</span>
<span class="normal">416</span>
<span class="normal">417</span>
<span class="normal">418</span>
<span class="normal">419</span>
<span class="normal">420</span>
<span class="normal">421</span>
<span class="normal">422</span>
<span class="normal">423</span>
<span class="normal">424</span>
<span class="normal">425</span>
<span class="normal">426</span>
<span class="normal">427</span>
<span class="normal">428</span>
<span class="normal">429</span>
<span class="normal">430</span>
<span class="normal">431</span>
<span class="normal">432</span>
<span class="normal">433</span>
<span class="normal">434</span>
<span class="normal">435</span>
<span class="normal">436</span>
<span class="normal">437</span>
<span class="normal">438</span>
<span class="normal">439</span>
<span class="normal">440</span>
<span class="normal">441</span>
<span class="normal">442</span>
<span class="normal">443</span>
<span class="normal">444</span>
<span class="normal">445</span>
<span class="normal">446</span>
<span class="normal">447</span>
<span class="normal">448</span>
<span class="normal">449</span>
<span class="normal">450</span>
<span class="normal">451</span>
<span class="normal">452</span>
<span class="normal">453</span>
<span class="normal">454</span>
<span class="normal">455</span>
<span class="normal">456</span>
<span class="normal">457</span>
<span class="normal">458</span>
<span class="normal">459</span>
<span class="normal">460</span>
<span class="normal">461</span>
<span class="normal">462</span>
<span class="normal">463</span>
<span class="normal">464</span>
<span class="normal">465</span>
<span class="normal">466</span>
<span class="normal">467</span>
<span class="normal">468</span>
<span class="normal">469</span>
<span class="normal">470</span>
<span class="normal">471</span>
<span class="normal">472</span>
<span class="normal">473</span>
<span class="normal">474</span>
<span class="normal">475</span>
<span class="normal">476</span>
<span class="normal">477</span>
<span class="normal">478</span>
<span class="normal">479</span>
<span class="normal">480</span>
<span class="normal">481</span>
<span class="normal">482</span>
<span class="normal">483</span>
<span class="normal">484</span>
<span class="normal">485</span>
<span class="normal">486</span>
<span class="normal">487</span>
<span class="normal">488</span>
<span class="normal">489</span>
<span class="normal">490</span>
<span class="normal">491</span>
<span class="normal">492</span>
<span class="normal">493</span>
<span class="normal">494</span>
<span class="normal">495</span>
<span class="normal">496</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">class</span> <span class="nc">Chunk</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Class for Reading output from LAMMPS chunk/ave command.&quot;&quot;&quot;</span>

    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span>
        <span class="bp">self</span><span class="p">,</span>
        <span class="n">thermo_df</span><span class="p">:</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">,</span>
        <span class="n">CLEANUP</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
        <span class="n">coord_cols</span><span class="o">=</span><span class="p">[</span><span class="s2">&quot;Coord1&quot;</span><span class="p">,</span> <span class="s2">&quot;Coord2&quot;</span><span class="p">,</span> <span class="s2">&quot;Coord3&quot;</span><span class="p">,</span> <span class="s2">&quot;coord&quot;</span><span class="p">,</span> <span class="s2">&quot;Box&quot;</span><span class="p">],</span>
        <span class="n">centred</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span>
        <span class="n">centered</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
        <span class="o">**</span><span class="n">kwargs</span><span class="p">,</span>
    <span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Construct a `Chunk`  from a pandas Dataframe.</span>

<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>
<span class="sd">        thermo_df :</span>
<span class="sd">            Data frame to read values from.</span>
<span class="sd">        CLEANUP :</span>
<span class="sd">            If true, the headers of the DataFrame are tided up to become valid python</span>
<span class="sd">            identifiers and strips the prefixes from compute/fix and variable columns.</span>
<span class="sd">        centred :</span>
<span class="sd">            Whether the coordinates of the system are already centred. This option</span>
<span class="sd">            will be deprecated; the centring calculation is cheap.</span>

<span class="sd">        &quot;&quot;&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">data</span><span class="p">:</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span> <span class="o">=</span> <span class="n">thermo_df</span>

        <span class="c1"># clean up dataframe</span>

        <span class="c1"># apply strip_pref function to remove &#39;c_/f_/v_&#39; prefixes to all columns</span>
        <span class="k">if</span> <span class="n">CLEANUP</span><span class="p">:</span>
            <span class="c1"># TODO: the prefix stripping should not be done if there ends up being</span>
            <span class="c1"># ambiguity between the fields; for example if c_foo and f_foo are both</span>
            <span class="c1"># defined</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">data</span><span class="o">.</span><span class="n">rename</span><span class="p">(</span><span class="n">columns</span><span class="o">=</span><span class="n">lmp_utils</span><span class="o">.</span><span class="n">strip_pref</span><span class="p">,</span> <span class="n">inplace</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">data</span><span class="o">.</span><span class="n">rename</span><span class="p">(</span><span class="n">columns</span><span class="o">=</span><span class="n">lmp_utils</span><span class="o">.</span><span class="n">drop_python_bad</span><span class="p">,</span> <span class="n">inplace</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>

        <span class="c1"># set the columns as attributes</span>
        <span class="k">for</span> <span class="n">col</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">data</span><span class="o">.</span><span class="n">columns</span><span class="p">:</span>
            <span class="c1"># has to be set to a method of the class</span>
            <span class="nb">setattr</span><span class="p">(</span>
                <span class="bp">self</span><span class="o">.</span><span class="vm">__class__</span><span class="p">,</span> <span class="n">col</span><span class="p">,</span> <span class="n">raise_col</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">col</span><span class="p">)</span>
            <span class="p">)</span>  <span class="c1"># set attribute to this property object??</span>
        <span class="c1"># column names for the coordinates, up to 3</span>
        <span class="c1"># only those in the df are included, by finding intersect of sets.</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">coord_cols</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span><span class="nb">set</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">data</span><span class="o">.</span><span class="n">columns</span><span class="o">.</span><span class="n">to_list</span><span class="p">())</span> <span class="o">&amp;</span> <span class="nb">set</span><span class="p">(</span><span class="n">coord_cols</span><span class="p">))</span>
        <span class="k">if</span> <span class="n">centered</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">centred</span> <span class="o">=</span> <span class="n">centered</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">centred</span> <span class="o">=</span> <span class="n">centred</span>  <span class="c1"># Initialise assuming asymmetrical - to do implement a method to check this!!!!</span>

    <span class="c1"># Property Definitions</span>

    <span class="nd">@property</span>
    <span class="k">def</span> <span class="nf">centered</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">bool</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Return whether the coordinates have already been centred.&quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">centred</span>

    <span class="nd">@classmethod</span>
    <span class="k">def</span> <span class="nf">create_chunk</span><span class="p">(</span><span class="bp">cls</span><span class="p">,</span> <span class="n">fname</span><span class="p">:</span> <span class="nb">str</span> <span class="o">|</span> <span class="n">PathLike</span><span class="p">,</span> <span class="n">style</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="s2">&quot;lmp&quot;</span><span class="p">,</span> <span class="n">last</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">True</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Load LAMMPS or numpy savetxt as a df and then create a Chunk instance.</span>

<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>
<span class="sd">        fname:</span>
<span class="sd">            File to load.</span>
<span class="sd">        style:</span>
<span class="sd">            What is the format of the file.</span>
<span class="sd">            Supported values are &quot;lmp&quot; and &quot;np&quot;, for lammps chunkfiles and numpy</span>
<span class="sd">            savetxt output, respectively.</span>
<span class="sd">        last:</span>
<span class="sd">            Only true is supported. Whether to read the last frame of the chunk file</span>
<span class="sd">            or all of them. Use `MultiChunk` if all frames are needed.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="c1"># TODO: Implement .xvg styles</span>
        <span class="c1"># TODO: Implement auto choosing the style, either with file extensions</span>
        <span class="c1"># or some form of try and fail</span>

        <span class="c1"># if style == &#39;auto&#39;:</span>
        <span class="c1">#     try:</span>
        <span class="c1">#         with open(fname,&#39;r&#39;) as stream:</span>
        <span class="c1">#             for i,line in enumerate(stream):</span>
        <span class="c1">#                 if i==3: int(line.split()[1]) # try to cast into an integer, if this fails, likely not lmp style</span>
        <span class="c1">#         style = &#39;lmp&#39;</span>
        <span class="c1">#     except ValueError:</span>
        <span class="c1">#         # set style = &#39;np&#39;</span>
        <span class="c1">#         style = &#39;np&#39;</span>
        <span class="k">if</span> <span class="n">style</span> <span class="o">==</span> <span class="s2">&quot;lmp&quot;</span><span class="p">:</span>
            <span class="k">if</span> <span class="n">last</span><span class="p">:</span>
                <span class="n">df</span> <span class="o">=</span> <span class="n">parse_chunks</span><span class="o">.</span><span class="n">lmp_last_chunk</span><span class="p">(</span><span class="n">fname</span><span class="p">,</span> <span class="n">nchunks</span><span class="o">=</span><span class="s2">&quot;auto&quot;</span><span class="p">,</span> <span class="n">header_rows</span><span class="o">=</span><span class="mi">3</span><span class="p">)</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="k">raise</span> <span class="ne">NotImplementedError</span><span class="p">(</span>
                    <span class="s2">&quot;Only the last chunk is supported at the moment.&quot;</span>
                <span class="p">)</span>
        <span class="k">elif</span> <span class="n">style</span> <span class="o">==</span> <span class="s2">&quot;np&quot;</span><span class="p">:</span>
            <span class="c1"># read the data frame from a space separated file outputted by np.savetxt.</span>
            <span class="n">df</span> <span class="o">=</span> <span class="n">parse_chunks</span><span class="o">.</span><span class="n">parse_numpy_file</span><span class="p">(</span><span class="n">fname</span><span class="p">,</span> <span class="n">header_row</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span> <span class="n">comment</span><span class="o">=</span><span class="s2">&quot;#&quot;</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">NotImplementedError</span><span class="p">(</span>
                <span class="s2">&quot;Only LAMMPS chunk files and numpy save_txt files are supported so far.&quot;</span>
            <span class="p">)</span>

        <span class="k">return</span> <span class="bp">cls</span><span class="p">(</span><span class="n">df</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">raise_columns</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Raise columns from the df to be attributes.&quot;&quot;&quot;</span>
        <span class="c1"># I have no clue how pandas does this automatically...</span>
        <span class="c1"># Maybe I need to make it so my objects can be indexed</span>
        <span class="c1"># and in doing that for assignment, the attributes can be raised up</span>
        <span class="c1"># TODO : Something with above??</span>
        <span class="n">df_utils</span><span class="o">.</span><span class="n">raise_columns</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">prop_grad</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">prop</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span> <span class="n">coord</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Calculate the gradient of `prop` with respect to `coord`.</span>

<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>
<span class="sd">        prop:</span>
<span class="sd">            Which property the gradient of is calculated</span>
<span class="sd">        coord:</span>
<span class="sd">            Which property is used for the coordinate.</span>
<span class="sd">        kwargs:</span>
<span class="sd">            Keyword arguments to pass to `np.gradient`</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">df</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">data</span>

        <span class="n">df</span><span class="p">[</span><span class="n">prop</span> <span class="o">+</span> <span class="s2">&quot;_grad&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">gradient</span><span class="p">(</span><span class="n">df</span><span class="p">[</span><span class="n">prop</span><span class="p">],</span> <span class="n">df</span><span class="p">[</span><span class="n">coord</span><span class="p">],</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>

        <span class="c1"># updates the columns</span>
        <span class="n">df_utils</span><span class="o">.</span><span class="n">raise_columns</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">nearest</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="nb">property</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span> <span class="n">value</span><span class="p">:</span> <span class="nb">float</span><span class="p">,</span> <span class="n">coord</span><span class="o">=</span><span class="mi">0</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Return the index for which property is closest to `value`.</span>

<span class="sd">        To do, return the actual row of properties??????</span>

<span class="sd">        This way if nan - make a nan list</span>

<span class="sd">        &quot;&quot;&quot;</span>
        <span class="c1"># TODO: Find out where this method is used and understand what on earth it does</span>
        <span class="n">coord</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">data</span><span class="p">[</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">coord_cols</span><span class="p">[</span><span class="n">coord</span><span class="p">]</span>
        <span class="p">]</span>  <span class="c1"># select coordinate column for which to find nearsest in each side</span>

        <span class="n">prop</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">data</span><span class="p">[</span><span class="nb">property</span><span class="p">]</span>
        <span class="c1"># if each half, find the index in each half of the simulation box</span>

        <span class="n">left</span> <span class="o">=</span> <span class="n">prop</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="n">coord</span> <span class="o">&lt;</span> <span class="mi">0</span><span class="p">]</span>
        <span class="n">right</span> <span class="o">=</span> <span class="n">prop</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="n">coord</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">]</span>

        <span class="n">right_nearest_index</span> <span class="o">=</span> <span class="n">right</span><span class="o">.</span><span class="n">sub</span><span class="p">(</span><span class="n">value</span><span class="p">)</span><span class="o">.</span><span class="n">abs</span><span class="p">()</span><span class="o">.</span><span class="n">idxmin</span><span class="p">()</span>

        <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">left</span><span class="o">.</span><span class="n">index</span><span class="p">)</span> <span class="o">!=</span> <span class="mi">0</span><span class="p">:</span>
            <span class="n">left_nearest_index</span> <span class="o">=</span> <span class="n">left</span><span class="o">.</span><span class="n">sub</span><span class="p">(</span><span class="n">value</span><span class="p">)</span><span class="o">.</span><span class="n">abs</span><span class="p">()</span><span class="o">.</span><span class="n">idxmin</span><span class="p">()</span>
            <span class="n">indexes</span> <span class="o">=</span> <span class="p">[</span><span class="n">left_nearest_index</span><span class="p">,</span> <span class="n">right_nearest_index</span><span class="p">]</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">indexes</span> <span class="o">=</span> <span class="p">[</span><span class="n">right_nearest_index</span><span class="p">]</span>

        <span class="k">try</span><span class="p">:</span>
            <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">data</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="n">indexes</span><span class="p">]</span><span class="o">.</span><span class="n">copy</span><span class="p">()</span>
        <span class="k">except</span> <span class="ne">KeyError</span><span class="p">:</span>  <span class="c1"># just create an empty row</span>
            <span class="n">row_copy</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">data</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span>
                <span class="p">(</span><span class="mi">0</span><span class="p">,),</span> <span class="p">:</span>
            <span class="p">]</span><span class="o">.</span><span class="n">copy</span><span class="p">()</span>  <span class="c1"># janky indexing makes it a df rather than a series</span>
            <span class="n">row_copy</span><span class="o">.</span><span class="n">loc</span><span class="p">[:]</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">nan</span>
            <span class="k">return</span> <span class="n">row_copy</span>

    <span class="k">def</span> <span class="nf">centre</span><span class="p">(</span>
        <span class="bp">self</span><span class="p">,</span> <span class="n">coord</span><span class="p">:</span> <span class="nb">int</span> <span class="o">|</span> <span class="nb">str</span> <span class="o">|</span> <span class="n">List</span><span class="p">[</span><span class="nb">str</span><span class="p">]</span> <span class="o">=</span> <span class="s2">&quot;all&quot;</span><span class="p">,</span> <span class="n">moment</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="nb">int</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span>
    <span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Shift the origin of the simulation box to zero.</span>

<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>
<span class="sd">        coord:</span>
<span class="sd">            Index of coordinate column to centre , indexes self.coord_cols.</span>
<span class="sd">            Default is &#39;all&#39;.</span>

<span class="sd">        moment:</span>
<span class="sd">            If Not None, centres the system to this column name,</span>
<span class="sd">            weighted by this column name raised to the power of moment.</span>

<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="n">coord</span> <span class="o">==</span> <span class="s2">&quot;all&quot;</span><span class="p">:</span>
            <span class="c1"># calculate the union of the list of coord_cols and the df columns</span>
            <span class="n">coords</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">coord_cols</span>

        <span class="k">elif</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">coord</span><span class="p">,</span> <span class="nb">int</span><span class="p">):</span>
            <span class="n">coords</span> <span class="o">=</span> <span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">coord_cols</span><span class="p">[</span><span class="n">coord</span><span class="p">]]</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="c1"># if neither a number or &#39;all&#39;, assumes a column name</span>
            <span class="n">coords</span> <span class="o">=</span> <span class="p">[</span><span class="n">coord</span><span class="p">]</span>
        <span class="c1"># iterate over selected coordinates and perform the centring operation</span>
        <span class="k">for</span> <span class="n">coord_col</span> <span class="ow">in</span> <span class="n">coords</span><span class="p">:</span>
            <span class="k">if</span> <span class="n">moment</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">data</span><span class="p">[</span><span class="n">coord_col</span><span class="p">]</span> <span class="o">-=</span> <span class="bp">self</span><span class="o">.</span><span class="n">moment</span><span class="p">(</span>
                    <span class="n">coord_col</span><span class="p">,</span> <span class="n">moment</span>
                <span class="p">)</span>  <span class="c1"># set origin to be first moment, weighted by moment parameter</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="c1"># print(coord_col)</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">data</span><span class="p">[</span><span class="n">coord_col</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">centre_series</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">data</span><span class="p">[</span><span class="n">coord_col</span><span class="p">])</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">centred</span> <span class="o">=</span> <span class="kc">True</span>
        <span class="c1"># Return the object at the end for method chaining</span>
        <span class="k">return</span> <span class="bp">self</span>

    <span class="k">def</span> <span class="nf">center</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">coord</span><span class="o">=</span><span class="s2">&quot;all&quot;</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;An alias of centre for yanks.&quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">centre</span><span class="p">(</span><span class="n">coord</span><span class="o">=</span><span class="n">coord</span><span class="p">)</span>

    <span class="nd">@staticmethod</span>
    <span class="k">def</span> <span class="nf">centre_series</span><span class="p">(</span><span class="n">series</span><span class="p">:</span> <span class="n">pd</span><span class="o">.</span><span class="n">Series</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Subtract the average of a series from the series.&quot;&quot;&quot;</span>
        <span class="n">centre</span> <span class="o">=</span> <span class="p">(</span><span class="n">series</span><span class="o">.</span><span class="n">max</span><span class="p">()</span> <span class="o">+</span> <span class="n">series</span><span class="o">.</span><span class="n">min</span><span class="p">())</span> <span class="o">/</span> <span class="mi">2</span>
        <span class="n">centred</span> <span class="o">=</span> <span class="n">series</span> <span class="o">-</span> <span class="n">centre</span>
        <span class="k">return</span> <span class="n">centred</span>

    <span class="k">def</span> <span class="nf">parity</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">prop</span><span class="p">,</span> <span class="n">coord</span><span class="o">=</span><span class="mi">0</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Multiplies a property by the sign of the coordinate.</span>

<span class="sd">        Should only be applied to properties that are pseudo scalars,  i.e. change</span>
<span class="sd">        sign under coordinate inversion, so that upon folding and averaging</span>
<span class="sd">        properties are correct.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="c1"># centre first</span>
        <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">coord</span><span class="p">,</span> <span class="nb">int</span><span class="p">):</span>
            <span class="n">coord</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">coord_cols</span><span class="p">[</span><span class="n">coord</span><span class="p">]</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">centred</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">centre</span><span class="p">()</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">data</span><span class="p">[</span><span class="n">prop</span> <span class="o">+</span> <span class="s2">&quot;_original&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">data</span><span class="p">[</span><span class="n">prop</span><span class="p">]</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">data</span><span class="p">[</span><span class="n">prop</span><span class="p">]</span> <span class="o">*=</span> <span class="n">np</span><span class="o">.</span><span class="n">sign</span><span class="p">(</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">data</span><span class="p">[</span><span class="n">coord</span><span class="p">]</span>
        <span class="p">)</span>  <span class="c1"># multiply by the sign of the coordinate column</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">raise_columns</span><span class="p">()</span>

    <span class="k">def</span> <span class="nf">moment</span><span class="p">(</span>
        <span class="bp">self</span><span class="p">,</span>
        <span class="n">coord</span><span class="p">,</span>
        <span class="n">weighting</span><span class="p">,</span>
        <span class="n">order</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span>
    <span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Calculate the specified moment of the coordinate, weighted by a named property&quot;&quot;&quot;</span>
        <span class="n">coords</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">data</span><span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">choose_coordinate</span><span class="p">(</span><span class="n">coord</span><span class="p">)]</span><span class="o">.</span><span class="n">T</span>

        <span class="n">integrand</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">data</span><span class="p">[</span><span class="n">weighting</span><span class="p">]</span> <span class="o">*</span> <span class="n">coords</span><span class="o">**</span><span class="n">order</span>
        <span class="n">normaliser</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">trapz</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">data</span><span class="p">[</span><span class="n">weighting</span><span class="p">],</span> <span class="n">coords</span><span class="p">)</span>

        <span class="k">return</span> <span class="n">np</span><span class="o">.</span><span class="n">trapz</span><span class="p">(</span><span class="n">integrand</span><span class="p">,</span> <span class="n">coords</span><span class="p">)</span> <span class="o">/</span> <span class="n">normaliser</span>

    <span class="k">def</span> <span class="nf">choose_coordinate</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">coord</span><span class="p">:</span> <span class="nb">int</span> <span class="o">|</span> <span class="nb">str</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Find the provided coordinate column(s).</span>

<span class="sd">        If an integer, indexes the self.coord_cols field,</span>
<span class="sd">        if string &#39;all&#39;, returns self.coord_cols</span>
<span class="sd">        if any other, returns</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="n">coord</span> <span class="o">==</span> <span class="s2">&quot;all&quot;</span><span class="p">:</span>
            <span class="c1"># calculate the union of the list of coord_cols and the df columns</span>
            <span class="n">coords</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">coord_cols</span>

        <span class="k">elif</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">coord</span><span class="p">,</span> <span class="nb">int</span><span class="p">):</span>
            <span class="n">coords</span> <span class="o">=</span> <span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">coord_cols</span><span class="p">[</span><span class="n">coord</span><span class="p">]]</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="c1"># if neither a number or &#39;all&#39;, assumes a column name</span>
            <span class="n">coords</span> <span class="o">=</span> <span class="p">[</span><span class="n">coord</span><span class="p">]</span>

        <span class="k">return</span> <span class="n">coords</span>

    <span class="k">def</span> <span class="nf">fold</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">crease</span><span class="o">=</span><span class="mf">0.0</span><span class="p">,</span> <span class="n">coord</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">coord_i</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="mi">0</span><span class="p">,</span> <span class="n">sort</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="n">inplace</span><span class="o">=</span><span class="kc">True</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Fold the profile about coord = crease.</span>

<span class="sd">        WARNING: if properties have been calculated prior to folding, they may no</span>
<span class="sd">        longer be correct.</span>

<span class="sd">        For example, electric fields calculated by integrating charge profiles,</span>
<span class="sd">        will have a different sign in each part of the box.</span>

<span class="sd">        To deal with this they should be inverted based on the sign of the coordiante.</span>

<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>
<span class="sd">        crease: -</span>
<span class="sd">                Position along folded coordinate to fold about</span>

<span class="sd">        coord_i : int -</span>
<span class="sd">                The index of the self.coord_cols list. Default is 0, the first coord</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="n">coord</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">coord_name</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">coord_cols</span><span class="p">[</span><span class="n">coord_i</span><span class="p">]</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">coord_name</span> <span class="o">=</span> <span class="n">coord</span>

        <span class="k">if</span> <span class="p">(</span><span class="n">crease</span> <span class="o">==</span> <span class="mi">0</span><span class="p">)</span> <span class="ow">and</span> <span class="bp">self</span><span class="o">.</span><span class="n">centred</span><span class="p">:</span>
            <span class="c1"># don&#39;t bother finding fold line, just go straight to folding!!!</span>
            <span class="c1"># in this case fold by making all negative and</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">data</span><span class="p">[</span><span class="n">coord_name</span><span class="p">]</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">absolute</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">data</span><span class="p">[</span><span class="n">coord_name</span><span class="p">])</span>
        <span class="k">elif</span> <span class="n">crease</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
            <span class="c1"># if the crease is located at coord = 0, but not already centred then - centres</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">centre</span><span class="p">(</span><span class="n">coord</span><span class="o">=</span><span class="n">coord_name</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">data</span><span class="p">[</span><span class="n">coord_name</span><span class="p">]</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">absolute</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">data</span><span class="p">[</span><span class="n">coord_name</span><span class="p">])</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="c1"># folding about some other value</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">data</span><span class="p">[</span><span class="n">coord_name</span><span class="p">]</span> <span class="o">-=</span> <span class="p">(</span>
                <span class="n">crease</span>  <span class="c1"># set origin to the value to be creased about</span>
            <span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">data</span><span class="p">[</span><span class="n">coord_name</span><span class="p">]</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">absolute</span><span class="p">(</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">data</span><span class="p">[</span><span class="n">coord_name</span><span class="p">]</span>
            <span class="p">)</span>  <span class="c1"># get absolute value</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">data</span><span class="p">[</span><span class="n">coord_name</span><span class="p">]</span> <span class="o">+=</span> <span class="p">(</span>
                <span class="n">crease</span>  <span class="c1"># add the crease value back so still starts at this value!</span>
            <span class="p">)</span>

        <span class="c1"># TODO Implement fully, even when not centred!</span>

        <span class="c1"># TODO auto sort ?</span>

        <span class="k">if</span> <span class="n">sort</span><span class="p">:</span>
            <span class="c1"># sorts the data by this column name</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">data</span><span class="o">.</span><span class="n">sort_values</span><span class="p">(</span>
                <span class="n">by</span><span class="o">=</span><span class="n">coord_name</span><span class="p">,</span> <span class="n">inplace</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">ignore_index</span><span class="o">=</span><span class="kc">True</span>
            <span class="p">)</span>  <span class="c1"># labels 0,1,2.... Needed for future integration/differentaion operations in numpy</span>

        <span class="k">pass</span>

    <span class="k">def</span> <span class="nf">rebin</span><span class="p">(</span>
        <span class="bp">self</span><span class="p">,</span>
        <span class="n">coord</span><span class="p">,</span>
        <span class="n">bw</span><span class="o">=</span><span class="mf">0.25</span><span class="p">,</span>
        <span class="n">bins</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
        <span class="n">nbins</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
        <span class="n">mode</span><span class="o">=</span><span class="s2">&quot;average&quot;</span><span class="p">,</span>
        <span class="n">inplace</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span>
        <span class="n">new_coord_loc</span><span class="o">=</span><span class="s2">&quot;mid&quot;</span><span class="p">,</span>
        <span class="n">weights</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
    <span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Rebin the data based on coordinates for a given new bin width.</span>

<span class="sd">        Default is to perform averages over these bins.</span>
<span class="sd">        Could also add weightings for these averages</span>

<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>
<span class="sd">        coord:</span>
<span class="sd">            Column name of the coordinate to create the bins from</span>

<span class="sd">        nbins:</span>
<span class="sd">            None, int, or array of ints. Number of bins for each binning dimension.</span>
<span class="sd">            Currently only supported for 2D bins.</span>

<span class="sd">        new_coord_loc:</span>
<span class="sd">            &quot;mid&quot; (default), &quot;left&quot; or &quot;right&quot; position of new coordinate,</span>
<span class="sd">            when set manually rather than from average. Currently only for 2D bins</span>

<span class="sd">        inplace : bool</span>
<span class="sd">            if True, overwrites the .data method, else just returns the data frame.</span>

<span class="sd">        weights:</span>
<span class="sd">            Column label for performing a weighted average,</span>
<span class="sd">            only used if mode is &quot;average&quot; or &quot;mean&quot;</span>

<span class="sd">        &quot;&quot;&quot;</span>
        <span class="c1"># TODO: - implement n_bins argument for 1d bins</span>
        <span class="n">df</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">data</span>

        <span class="c1"># Use multiple bins</span>
        <span class="k">if</span> <span class="n">np</span><span class="o">.</span><span class="n">iterable</span><span class="p">(</span><span class="n">coord</span><span class="p">)</span> <span class="ow">and</span> <span class="ow">not</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">coord</span><span class="p">,</span> <span class="nb">str</span><span class="p">):</span>
            <span class="n">number_coords</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="n">coord</span><span class="p">)</span>
            <span class="k">if</span> <span class="n">number_coords</span> <span class="o">==</span> <span class="mi">2</span><span class="p">:</span>
                <span class="n">coord1</span><span class="p">,</span> <span class="n">coord2</span> <span class="o">=</span> <span class="n">coord</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">coord</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span>
                <span class="n">df_binned</span> <span class="o">=</span> <span class="n">df_utils</span><span class="o">.</span><span class="n">rebin_2D</span><span class="p">(</span>
                    <span class="n">df</span><span class="p">,</span>
                    <span class="n">coord1</span><span class="p">,</span>
                    <span class="n">coord2</span><span class="p">,</span>
                    <span class="n">bw</span><span class="o">=</span><span class="n">bw</span><span class="p">,</span>
                    <span class="n">bins</span><span class="o">=</span><span class="n">bins</span><span class="p">,</span>
                    <span class="n">mode</span><span class="o">=</span><span class="n">mode</span><span class="p">,</span>
                    <span class="n">nbins</span><span class="o">=</span><span class="n">nbins</span><span class="p">,</span>
                    <span class="n">new_coord_loc</span><span class="o">=</span><span class="n">new_coord_loc</span><span class="p">,</span>
                    <span class="n">weight_col</span><span class="o">=</span><span class="n">weights</span><span class="p">,</span>
                <span class="p">)</span>
            <span class="k">elif</span> <span class="n">np</span><span class="o">.</span><span class="n">number</span> <span class="o">&gt;=</span> <span class="mi">3</span><span class="p">:</span>
                <span class="k">raise</span> <span class="ne">NotImplementedError</span><span class="p">(</span>
                    <span class="s2">&quot;Binning in more than two dimensions not yet supported&quot;</span>
                <span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">df_binned</span> <span class="o">=</span> <span class="n">df_utils</span><span class="o">.</span><span class="n">rebin</span><span class="p">(</span>
                <span class="n">df</span><span class="p">,</span> <span class="n">coord</span><span class="p">,</span> <span class="n">bw</span><span class="o">=</span><span class="n">bw</span><span class="p">,</span> <span class="n">mode</span><span class="o">=</span><span class="n">mode</span><span class="p">,</span> <span class="n">weight_col</span><span class="o">=</span><span class="n">weights</span><span class="p">,</span> <span class="n">bins</span><span class="o">=</span><span class="n">bins</span>
            <span class="p">)</span>
        <span class="c1"># coord_max = df[coord].max()</span>
        <span class="c1"># coord_min = df[coord].min() # finding min and max so it works with gfolded data</span>

        <span class="c1"># n_bins = (coord_max-coord_min) // bw #double divide is floor division</span>
        <span class="c1"># n_bins = int(n_bins)</span>

        <span class="c1"># bins = pd.cut(df[coord],n_bins)</span>

        <span class="c1"># df_grouped = df.groupby(bins)</span>

        <span class="c1"># if mode == &#39;average&#39; or mode == &#39;mean&#39;:</span>
        <span class="c1">#     df_binned = df_grouped.mean()</span>
        <span class="c1"># else:</span>
        <span class="c1">#     df_binned = df_grouped.sum()</span>

        <span class="c1"># TODO:  Why is df_binned possibly unbound?</span>
        <span class="k">if</span> <span class="n">inplace</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">data</span> <span class="o">=</span> <span class="n">df_binned</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">return</span> <span class="n">df_binned</span>

    <span class="k">def</span> <span class="nf">fold_and_ave</span><span class="p">(</span>
        <span class="bp">self</span><span class="p">,</span> <span class="n">crease</span><span class="o">=</span><span class="mf">0.0</span><span class="p">,</span> <span class="n">coord</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">coord_i</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span> <span class="n">sort</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">bw</span><span class="p">:</span> <span class="nb">str</span> <span class="o">|</span> <span class="nb">float</span> <span class="o">=</span> <span class="s2">&quot;auto&quot;</span>
    <span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Fold the profile and average the two halves.</span>

<span class="sd">            WARNING: if properties have been calculated prior to folding,</span>
<span class="sd">            they may no longer be correct, epsecially properties that invert under coordinate inversion (pseudoscalars)</span>

<span class="sd">            For example, electric fields calculated by integrating charge profiles, will have a different sign in each part of the box.</span>

<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>
<span class="sd">        crease:</span>
<span class="sd">                Position along folded coordinate to fold about</span>

<span class="sd">        coord_i : int</span>
<span class="sd">                The index of the self.coord_cols list. Default is 0, the first coord</span>
<span class="sd">                if all, will fold all coordinates, but will only crease</span>

<span class="sd">        bw:</span>
<span class="sd">            Averaging works by rebinning</span>
<span class="sd">            If auto, tries to work out the original bin spacing and then groups by this</span>
<span class="sd">            If not auto, specify the bin width in distance.</span>

<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="n">coord</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="k">if</span> <span class="n">coord_i</span> <span class="o">==</span> <span class="s2">&quot;all&quot;</span><span class="p">:</span>
                <span class="n">coord_names</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">coord_cols</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">coord_names</span> <span class="o">=</span> <span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">coord_cols</span><span class="p">[</span><span class="n">coord_i</span><span class="p">]]</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">coord_names</span> <span class="o">=</span> <span class="p">[</span><span class="n">coord</span><span class="p">]</span>

        <span class="k">if</span> <span class="n">crease</span> <span class="o">==</span> <span class="mf">0.0</span> <span class="ow">and</span> <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">centred</span><span class="p">:</span>
            <span class="c1"># if the crease is located at coord = 0, but not already centred then - centres</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">centre</span><span class="p">(</span><span class="n">coord</span><span class="o">=</span><span class="n">coord_names</span><span class="p">)</span>

        <span class="n">df</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">data</span><span class="o">.</span><span class="n">copy</span><span class="p">()</span>

        <span class="n">coord1</span> <span class="o">=</span> <span class="n">df</span><span class="p">[</span><span class="n">coord_names</span><span class="p">[</span><span class="mi">0</span><span class="p">]]</span>

        <span class="k">if</span> <span class="n">bw</span> <span class="o">==</span> <span class="s2">&quot;auto&quot;</span><span class="p">:</span>
            <span class="n">bw</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">abs</span><span class="p">(</span>
                <span class="n">coord1</span><span class="o">.</span><span class="n">iloc</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span> <span class="o">-</span> <span class="n">coord1</span><span class="o">.</span><span class="n">iloc</span><span class="p">[</span><span class="o">-</span><span class="mi">2</span><span class="p">]</span>
            <span class="p">)</span>  <span class="c1"># if auto work out from the difference of the last 2 points of the coord</span>

        <span class="c1"># # only index by the first coord,but flip all?</span>
        <span class="c1"># select_a = (df[coord_names[0]] &gt;=  0)</span>
        <span class="c1"># select_b = ~select_a</span>

        <span class="c1"># df_a = df.loc[select_a].sort_values(by = coord_names[0] ,inplace = True,ignore_index = True)</span>
        <span class="c1"># df_b = df.loc[select_b]</span>
        <span class="c1"># df_b[coord_names]=df_b[coord_names].abs()</span>
        <span class="c1"># df_b.sort_values(by = coord_names[0] ,inplace = True,ignore_index = True)</span>

        <span class="c1"># df_ave = pd.concat({&#39;a&#39;:df_a,&#39;b&#39;:df_b}).mean(level=1)</span>

        <span class="c1"># fold the df</span>
        <span class="n">df</span><span class="p">[</span><span class="n">coord_names</span><span class="p">]</span> <span class="o">=</span> <span class="p">(</span>
            <span class="n">np</span><span class="o">.</span><span class="n">abs</span><span class="p">(</span><span class="n">df</span><span class="p">[</span><span class="n">coord_names</span><span class="p">]</span> <span class="o">-</span> <span class="n">crease</span><span class="p">)</span> <span class="o">+</span> <span class="n">crease</span>
        <span class="p">)</span>  <span class="c1"># assumes already centred for now</span>
        <span class="n">df_ave</span> <span class="o">=</span> <span class="n">df_utils</span><span class="o">.</span><span class="n">rebin</span><span class="p">(</span><span class="n">df</span><span class="p">,</span> <span class="n">coord_names</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">bw</span><span class="p">)</span><span class="o">.</span><span class="n">sort_values</span><span class="p">(</span>
            <span class="n">coord_names</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
        <span class="p">)</span>  <span class="c1"># performing the rebinning # then sort by the coord</span>

        <span class="k">return</span> <span class="n">df_ave</span>
</code></pre></div></td></tr></table></div>
              </details>



  <div class="doc doc-children">







<div class="doc doc-object doc-attribute">



<h2 id="thermotar.chunk.Chunk.centered" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">centered</span><span class="p">:</span> <span class="nb">bool</span></code>

  <span class="doc doc-labels">
      <small class="doc doc-label doc-label-property"><code>property</code></small>
  </span>

</h2>


    <div class="doc doc-contents ">

      <p>Return whether the coordinates have already been centred.</p>
    </div>

</div>



<div class="doc doc-object doc-function">


<h2 id="thermotar.chunk.Chunk.__init__" class="doc doc-heading">
            <code class="highlight language-python"><span class="fm">__init__</span><span class="p">(</span><span class="n">thermo_df</span><span class="p">,</span> <span class="n">CLEANUP</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">coord_cols</span><span class="o">=</span><span class="p">[</span><span class="s1">&#39;Coord1&#39;</span><span class="p">,</span> <span class="s1">&#39;Coord2&#39;</span><span class="p">,</span> <span class="s1">&#39;Coord3&#39;</span><span class="p">,</span> <span class="s1">&#39;coord&#39;</span><span class="p">,</span> <span class="s1">&#39;Box&#39;</span><span class="p">],</span> <span class="n">centred</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="n">centered</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span></code>

</h2>


    <div class="doc doc-contents ">

      <p>Construct a <code>Chunk</code>  from a pandas Dataframe.</p>


<p><span class="doc-section-title">Parameters:</span></p>
    <table>
      <thead>
        <tr>
          <th>Name</th>
          <th>Type</th>
          <th>Description</th>
          <th>Default</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td><code>thermo_df</code></td>
            <td>
                  <code><span title="pandas.DataFrame">DataFrame</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Data frame to read values from.</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td><code>CLEANUP</code></td>
            <td>
            </td>
            <td>
              <div class="doc-md-description">
                <p>If true, the headers of the DataFrame are tided up to become valid python
identifiers and strips the prefixes from compute/fix and variable columns.</p>
              </div>
            </td>
            <td>
                  <code>True</code>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td><code>centred</code></td>
            <td>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Whether the coordinates of the system are already centred. This option
will be deprecated; the centring calculation is cheap.</p>
              </div>
            </td>
            <td>
                  <code>False</code>
            </td>
          </tr>
      </tbody>
    </table>

            <details class="quote">
              <summary>Source code in <code>thermotar/chunk.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">18</span>
<span class="normal">19</span>
<span class="normal">20</span>
<span class="normal">21</span>
<span class="normal">22</span>
<span class="normal">23</span>
<span class="normal">24</span>
<span class="normal">25</span>
<span class="normal">26</span>
<span class="normal">27</span>
<span class="normal">28</span>
<span class="normal">29</span>
<span class="normal">30</span>
<span class="normal">31</span>
<span class="normal">32</span>
<span class="normal">33</span>
<span class="normal">34</span>
<span class="normal">35</span>
<span class="normal">36</span>
<span class="normal">37</span>
<span class="normal">38</span>
<span class="normal">39</span>
<span class="normal">40</span>
<span class="normal">41</span>
<span class="normal">42</span>
<span class="normal">43</span>
<span class="normal">44</span>
<span class="normal">45</span>
<span class="normal">46</span>
<span class="normal">47</span>
<span class="normal">48</span>
<span class="normal">49</span>
<span class="normal">50</span>
<span class="normal">51</span>
<span class="normal">52</span>
<span class="normal">53</span>
<span class="normal">54</span>
<span class="normal">55</span>
<span class="normal">56</span>
<span class="normal">57</span>
<span class="normal">58</span>
<span class="normal">59</span>
<span class="normal">60</span>
<span class="normal">61</span>
<span class="normal">62</span>
<span class="normal">63</span>
<span class="normal">64</span>
<span class="normal">65</span>
<span class="normal">66</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span>
    <span class="bp">self</span><span class="p">,</span>
    <span class="n">thermo_df</span><span class="p">:</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">,</span>
    <span class="n">CLEANUP</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
    <span class="n">coord_cols</span><span class="o">=</span><span class="p">[</span><span class="s2">&quot;Coord1&quot;</span><span class="p">,</span> <span class="s2">&quot;Coord2&quot;</span><span class="p">,</span> <span class="s2">&quot;Coord3&quot;</span><span class="p">,</span> <span class="s2">&quot;coord&quot;</span><span class="p">,</span> <span class="s2">&quot;Box&quot;</span><span class="p">],</span>
    <span class="n">centred</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span>
    <span class="n">centered</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
    <span class="o">**</span><span class="n">kwargs</span><span class="p">,</span>
<span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Construct a `Chunk`  from a pandas Dataframe.</span>

<span class="sd">    Parameters</span>
<span class="sd">    ----------</span>
<span class="sd">    thermo_df :</span>
<span class="sd">        Data frame to read values from.</span>
<span class="sd">    CLEANUP :</span>
<span class="sd">        If true, the headers of the DataFrame are tided up to become valid python</span>
<span class="sd">        identifiers and strips the prefixes from compute/fix and variable columns.</span>
<span class="sd">    centred :</span>
<span class="sd">        Whether the coordinates of the system are already centred. This option</span>
<span class="sd">        will be deprecated; the centring calculation is cheap.</span>

<span class="sd">    &quot;&quot;&quot;</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">data</span><span class="p">:</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span> <span class="o">=</span> <span class="n">thermo_df</span>

    <span class="c1"># clean up dataframe</span>

    <span class="c1"># apply strip_pref function to remove &#39;c_/f_/v_&#39; prefixes to all columns</span>
    <span class="k">if</span> <span class="n">CLEANUP</span><span class="p">:</span>
        <span class="c1"># TODO: the prefix stripping should not be done if there ends up being</span>
        <span class="c1"># ambiguity between the fields; for example if c_foo and f_foo are both</span>
        <span class="c1"># defined</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">data</span><span class="o">.</span><span class="n">rename</span><span class="p">(</span><span class="n">columns</span><span class="o">=</span><span class="n">lmp_utils</span><span class="o">.</span><span class="n">strip_pref</span><span class="p">,</span> <span class="n">inplace</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">data</span><span class="o">.</span><span class="n">rename</span><span class="p">(</span><span class="n">columns</span><span class="o">=</span><span class="n">lmp_utils</span><span class="o">.</span><span class="n">drop_python_bad</span><span class="p">,</span> <span class="n">inplace</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>

    <span class="c1"># set the columns as attributes</span>
    <span class="k">for</span> <span class="n">col</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">data</span><span class="o">.</span><span class="n">columns</span><span class="p">:</span>
        <span class="c1"># has to be set to a method of the class</span>
        <span class="nb">setattr</span><span class="p">(</span>
            <span class="bp">self</span><span class="o">.</span><span class="vm">__class__</span><span class="p">,</span> <span class="n">col</span><span class="p">,</span> <span class="n">raise_col</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">col</span><span class="p">)</span>
        <span class="p">)</span>  <span class="c1"># set attribute to this property object??</span>
    <span class="c1"># column names for the coordinates, up to 3</span>
    <span class="c1"># only those in the df are included, by finding intersect of sets.</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">coord_cols</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span><span class="nb">set</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">data</span><span class="o">.</span><span class="n">columns</span><span class="o">.</span><span class="n">to_list</span><span class="p">())</span> <span class="o">&amp;</span> <span class="nb">set</span><span class="p">(</span><span class="n">coord_cols</span><span class="p">))</span>
    <span class="k">if</span> <span class="n">centered</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
        <span class="n">centred</span> <span class="o">=</span> <span class="n">centered</span>

    <span class="bp">self</span><span class="o">.</span><span class="n">centred</span> <span class="o">=</span> <span class="n">centred</span>  <span class="c1"># Initialise assuming asymmetrical - to do implement a method to check this!!!!</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h2 id="thermotar.chunk.Chunk.center" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">center</span><span class="p">(</span><span class="n">coord</span><span class="o">=</span><span class="s1">&#39;all&#39;</span><span class="p">)</span></code>

</h2>


    <div class="doc doc-contents ">

      <p>An alias of centre for yanks.</p>

            <details class="quote">
              <summary>Source code in <code>thermotar/chunk.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">224</span>
<span class="normal">225</span>
<span class="normal">226</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span> <span class="nf">center</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">coord</span><span class="o">=</span><span class="s2">&quot;all&quot;</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;An alias of centre for yanks.&quot;&quot;&quot;</span>
    <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">centre</span><span class="p">(</span><span class="n">coord</span><span class="o">=</span><span class="n">coord</span><span class="p">)</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h2 id="thermotar.chunk.Chunk.centre" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">centre</span><span class="p">(</span><span class="n">coord</span><span class="o">=</span><span class="s1">&#39;all&#39;</span><span class="p">,</span> <span class="n">moment</span><span class="o">=</span><span class="kc">None</span><span class="p">)</span></code>

</h2>


    <div class="doc doc-contents ">

      <p>Shift the origin of the simulation box to zero.</p>


<p><span class="doc-section-title">Parameters:</span></p>
    <table>
      <thead>
        <tr>
          <th>Name</th>
          <th>Type</th>
          <th>Description</th>
          <th>Default</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td><code>coord</code></td>
            <td>
                  <code>int | str | <span title="typing.List">List</span>[str]</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Index of coordinate column to centre , indexes self.coord_cols.
Default is 'all'.</p>
              </div>
            </td>
            <td>
                  <code>&#39;all&#39;</code>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td><code>moment</code></td>
            <td>
                  <code><span title="typing.Optional">Optional</span>[int]</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>If Not None, centres the system to this column name,
weighted by this column name raised to the power of moment.</p>
              </div>
            </td>
            <td>
                  <code>None</code>
            </td>
          </tr>
      </tbody>
    </table>

            <details class="quote">
              <summary>Source code in <code>thermotar/chunk.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">185</span>
<span class="normal">186</span>
<span class="normal">187</span>
<span class="normal">188</span>
<span class="normal">189</span>
<span class="normal">190</span>
<span class="normal">191</span>
<span class="normal">192</span>
<span class="normal">193</span>
<span class="normal">194</span>
<span class="normal">195</span>
<span class="normal">196</span>
<span class="normal">197</span>
<span class="normal">198</span>
<span class="normal">199</span>
<span class="normal">200</span>
<span class="normal">201</span>
<span class="normal">202</span>
<span class="normal">203</span>
<span class="normal">204</span>
<span class="normal">205</span>
<span class="normal">206</span>
<span class="normal">207</span>
<span class="normal">208</span>
<span class="normal">209</span>
<span class="normal">210</span>
<span class="normal">211</span>
<span class="normal">212</span>
<span class="normal">213</span>
<span class="normal">214</span>
<span class="normal">215</span>
<span class="normal">216</span>
<span class="normal">217</span>
<span class="normal">218</span>
<span class="normal">219</span>
<span class="normal">220</span>
<span class="normal">221</span>
<span class="normal">222</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span> <span class="nf">centre</span><span class="p">(</span>
    <span class="bp">self</span><span class="p">,</span> <span class="n">coord</span><span class="p">:</span> <span class="nb">int</span> <span class="o">|</span> <span class="nb">str</span> <span class="o">|</span> <span class="n">List</span><span class="p">[</span><span class="nb">str</span><span class="p">]</span> <span class="o">=</span> <span class="s2">&quot;all&quot;</span><span class="p">,</span> <span class="n">moment</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="nb">int</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span>
<span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Shift the origin of the simulation box to zero.</span>

<span class="sd">    Parameters</span>
<span class="sd">    ----------</span>
<span class="sd">    coord:</span>
<span class="sd">        Index of coordinate column to centre , indexes self.coord_cols.</span>
<span class="sd">        Default is &#39;all&#39;.</span>

<span class="sd">    moment:</span>
<span class="sd">        If Not None, centres the system to this column name,</span>
<span class="sd">        weighted by this column name raised to the power of moment.</span>

<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">if</span> <span class="n">coord</span> <span class="o">==</span> <span class="s2">&quot;all&quot;</span><span class="p">:</span>
        <span class="c1"># calculate the union of the list of coord_cols and the df columns</span>
        <span class="n">coords</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">coord_cols</span>

    <span class="k">elif</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">coord</span><span class="p">,</span> <span class="nb">int</span><span class="p">):</span>
        <span class="n">coords</span> <span class="o">=</span> <span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">coord_cols</span><span class="p">[</span><span class="n">coord</span><span class="p">]]</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="c1"># if neither a number or &#39;all&#39;, assumes a column name</span>
        <span class="n">coords</span> <span class="o">=</span> <span class="p">[</span><span class="n">coord</span><span class="p">]</span>
    <span class="c1"># iterate over selected coordinates and perform the centring operation</span>
    <span class="k">for</span> <span class="n">coord_col</span> <span class="ow">in</span> <span class="n">coords</span><span class="p">:</span>
        <span class="k">if</span> <span class="n">moment</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">data</span><span class="p">[</span><span class="n">coord_col</span><span class="p">]</span> <span class="o">-=</span> <span class="bp">self</span><span class="o">.</span><span class="n">moment</span><span class="p">(</span>
                <span class="n">coord_col</span><span class="p">,</span> <span class="n">moment</span>
            <span class="p">)</span>  <span class="c1"># set origin to be first moment, weighted by moment parameter</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="c1"># print(coord_col)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">data</span><span class="p">[</span><span class="n">coord_col</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">centre_series</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">data</span><span class="p">[</span><span class="n">coord_col</span><span class="p">])</span>

    <span class="bp">self</span><span class="o">.</span><span class="n">centred</span> <span class="o">=</span> <span class="kc">True</span>
    <span class="c1"># Return the object at the end for method chaining</span>
    <span class="k">return</span> <span class="bp">self</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h2 id="thermotar.chunk.Chunk.centre_series" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">centre_series</span><span class="p">(</span><span class="n">series</span><span class="p">)</span></code>

  <span class="doc doc-labels">
      <small class="doc doc-label doc-label-staticmethod"><code>staticmethod</code></small>
  </span>

</h2>


    <div class="doc doc-contents ">

      <p>Subtract the average of a series from the series.</p>

            <details class="quote">
              <summary>Source code in <code>thermotar/chunk.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">228</span>
<span class="normal">229</span>
<span class="normal">230</span>
<span class="normal">231</span>
<span class="normal">232</span>
<span class="normal">233</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="nd">@staticmethod</span>
<span class="k">def</span> <span class="nf">centre_series</span><span class="p">(</span><span class="n">series</span><span class="p">:</span> <span class="n">pd</span><span class="o">.</span><span class="n">Series</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Subtract the average of a series from the series.&quot;&quot;&quot;</span>
    <span class="n">centre</span> <span class="o">=</span> <span class="p">(</span><span class="n">series</span><span class="o">.</span><span class="n">max</span><span class="p">()</span> <span class="o">+</span> <span class="n">series</span><span class="o">.</span><span class="n">min</span><span class="p">())</span> <span class="o">/</span> <span class="mi">2</span>
    <span class="n">centred</span> <span class="o">=</span> <span class="n">series</span> <span class="o">-</span> <span class="n">centre</span>
    <span class="k">return</span> <span class="n">centred</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h2 id="thermotar.chunk.Chunk.choose_coordinate" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">choose_coordinate</span><span class="p">(</span><span class="n">coord</span><span class="p">)</span></code>

</h2>


    <div class="doc doc-contents ">

      <p>Find the provided coordinate column(s).</p>
<p>If an integer, indexes the self.coord_cols field,
if string 'all', returns self.coord_cols
if any other, returns</p>

            <details class="quote">
              <summary>Source code in <code>thermotar/chunk.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">269</span>
<span class="normal">270</span>
<span class="normal">271</span>
<span class="normal">272</span>
<span class="normal">273</span>
<span class="normal">274</span>
<span class="normal">275</span>
<span class="normal">276</span>
<span class="normal">277</span>
<span class="normal">278</span>
<span class="normal">279</span>
<span class="normal">280</span>
<span class="normal">281</span>
<span class="normal">282</span>
<span class="normal">283</span>
<span class="normal">284</span>
<span class="normal">285</span>
<span class="normal">286</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span> <span class="nf">choose_coordinate</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">coord</span><span class="p">:</span> <span class="nb">int</span> <span class="o">|</span> <span class="nb">str</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Find the provided coordinate column(s).</span>

<span class="sd">    If an integer, indexes the self.coord_cols field,</span>
<span class="sd">    if string &#39;all&#39;, returns self.coord_cols</span>
<span class="sd">    if any other, returns</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">if</span> <span class="n">coord</span> <span class="o">==</span> <span class="s2">&quot;all&quot;</span><span class="p">:</span>
        <span class="c1"># calculate the union of the list of coord_cols and the df columns</span>
        <span class="n">coords</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">coord_cols</span>

    <span class="k">elif</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">coord</span><span class="p">,</span> <span class="nb">int</span><span class="p">):</span>
        <span class="n">coords</span> <span class="o">=</span> <span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">coord_cols</span><span class="p">[</span><span class="n">coord</span><span class="p">]]</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="c1"># if neither a number or &#39;all&#39;, assumes a column name</span>
        <span class="n">coords</span> <span class="o">=</span> <span class="p">[</span><span class="n">coord</span><span class="p">]</span>

    <span class="k">return</span> <span class="n">coords</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h2 id="thermotar.chunk.Chunk.create_chunk" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">create_chunk</span><span class="p">(</span><span class="n">fname</span><span class="p">,</span> <span class="n">style</span><span class="o">=</span><span class="s1">&#39;lmp&#39;</span><span class="p">,</span> <span class="n">last</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span></code>

  <span class="doc doc-labels">
      <small class="doc doc-label doc-label-classmethod"><code>classmethod</code></small>
  </span>

</h2>


    <div class="doc doc-contents ">

      <p>Load LAMMPS or numpy savetxt as a df and then create a Chunk instance.</p>


<p><span class="doc-section-title">Parameters:</span></p>
    <table>
      <thead>
        <tr>
          <th>Name</th>
          <th>Type</th>
          <th>Description</th>
          <th>Default</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td><code>fname</code></td>
            <td>
                  <code>str | <span title="os.PathLike">PathLike</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>File to load.</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td><code>style</code></td>
            <td>
                  <code>str</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>What is the format of the file.
Supported values are "lmp" and "np", for lammps chunkfiles and numpy
savetxt output, respectively.</p>
              </div>
            </td>
            <td>
                  <code>&#39;lmp&#39;</code>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td><code>last</code></td>
            <td>
                  <code>bool</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Only true is supported. Whether to read the last frame of the chunk file
or all of them. Use <code>MultiChunk</code> if all frames are needed.</p>
              </div>
            </td>
            <td>
                  <code>True</code>
            </td>
          </tr>
      </tbody>
    </table>

            <details class="quote">
              <summary>Source code in <code>thermotar/chunk.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"> 75</span>
<span class="normal"> 76</span>
<span class="normal"> 77</span>
<span class="normal"> 78</span>
<span class="normal"> 79</span>
<span class="normal"> 80</span>
<span class="normal"> 81</span>
<span class="normal"> 82</span>
<span class="normal"> 83</span>
<span class="normal"> 84</span>
<span class="normal"> 85</span>
<span class="normal"> 86</span>
<span class="normal"> 87</span>
<span class="normal"> 88</span>
<span class="normal"> 89</span>
<span class="normal"> 90</span>
<span class="normal"> 91</span>
<span class="normal"> 92</span>
<span class="normal"> 93</span>
<span class="normal"> 94</span>
<span class="normal"> 95</span>
<span class="normal"> 96</span>
<span class="normal"> 97</span>
<span class="normal"> 98</span>
<span class="normal"> 99</span>
<span class="normal">100</span>
<span class="normal">101</span>
<span class="normal">102</span>
<span class="normal">103</span>
<span class="normal">104</span>
<span class="normal">105</span>
<span class="normal">106</span>
<span class="normal">107</span>
<span class="normal">108</span>
<span class="normal">109</span>
<span class="normal">110</span>
<span class="normal">111</span>
<span class="normal">112</span>
<span class="normal">113</span>
<span class="normal">114</span>
<span class="normal">115</span>
<span class="normal">116</span>
<span class="normal">117</span>
<span class="normal">118</span>
<span class="normal">119</span>
<span class="normal">120</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="nd">@classmethod</span>
<span class="k">def</span> <span class="nf">create_chunk</span><span class="p">(</span><span class="bp">cls</span><span class="p">,</span> <span class="n">fname</span><span class="p">:</span> <span class="nb">str</span> <span class="o">|</span> <span class="n">PathLike</span><span class="p">,</span> <span class="n">style</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="s2">&quot;lmp&quot;</span><span class="p">,</span> <span class="n">last</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">True</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Load LAMMPS or numpy savetxt as a df and then create a Chunk instance.</span>

<span class="sd">    Parameters</span>
<span class="sd">    ----------</span>
<span class="sd">    fname:</span>
<span class="sd">        File to load.</span>
<span class="sd">    style:</span>
<span class="sd">        What is the format of the file.</span>
<span class="sd">        Supported values are &quot;lmp&quot; and &quot;np&quot;, for lammps chunkfiles and numpy</span>
<span class="sd">        savetxt output, respectively.</span>
<span class="sd">    last:</span>
<span class="sd">        Only true is supported. Whether to read the last frame of the chunk file</span>
<span class="sd">        or all of them. Use `MultiChunk` if all frames are needed.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="c1"># TODO: Implement .xvg styles</span>
    <span class="c1"># TODO: Implement auto choosing the style, either with file extensions</span>
    <span class="c1"># or some form of try and fail</span>

    <span class="c1"># if style == &#39;auto&#39;:</span>
    <span class="c1">#     try:</span>
    <span class="c1">#         with open(fname,&#39;r&#39;) as stream:</span>
    <span class="c1">#             for i,line in enumerate(stream):</span>
    <span class="c1">#                 if i==3: int(line.split()[1]) # try to cast into an integer, if this fails, likely not lmp style</span>
    <span class="c1">#         style = &#39;lmp&#39;</span>
    <span class="c1">#     except ValueError:</span>
    <span class="c1">#         # set style = &#39;np&#39;</span>
    <span class="c1">#         style = &#39;np&#39;</span>
    <span class="k">if</span> <span class="n">style</span> <span class="o">==</span> <span class="s2">&quot;lmp&quot;</span><span class="p">:</span>
        <span class="k">if</span> <span class="n">last</span><span class="p">:</span>
            <span class="n">df</span> <span class="o">=</span> <span class="n">parse_chunks</span><span class="o">.</span><span class="n">lmp_last_chunk</span><span class="p">(</span><span class="n">fname</span><span class="p">,</span> <span class="n">nchunks</span><span class="o">=</span><span class="s2">&quot;auto&quot;</span><span class="p">,</span> <span class="n">header_rows</span><span class="o">=</span><span class="mi">3</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">NotImplementedError</span><span class="p">(</span>
                <span class="s2">&quot;Only the last chunk is supported at the moment.&quot;</span>
            <span class="p">)</span>
    <span class="k">elif</span> <span class="n">style</span> <span class="o">==</span> <span class="s2">&quot;np&quot;</span><span class="p">:</span>
        <span class="c1"># read the data frame from a space separated file outputted by np.savetxt.</span>
        <span class="n">df</span> <span class="o">=</span> <span class="n">parse_chunks</span><span class="o">.</span><span class="n">parse_numpy_file</span><span class="p">(</span><span class="n">fname</span><span class="p">,</span> <span class="n">header_row</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span> <span class="n">comment</span><span class="o">=</span><span class="s2">&quot;#&quot;</span><span class="p">)</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="k">raise</span> <span class="ne">NotImplementedError</span><span class="p">(</span>
            <span class="s2">&quot;Only LAMMPS chunk files and numpy save_txt files are supported so far.&quot;</span>
        <span class="p">)</span>

    <span class="k">return</span> <span class="bp">cls</span><span class="p">(</span><span class="n">df</span><span class="p">)</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h2 id="thermotar.chunk.Chunk.fold" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">fold</span><span class="p">(</span><span class="n">crease</span><span class="o">=</span><span class="mf">0.0</span><span class="p">,</span> <span class="n">coord</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">coord_i</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span> <span class="n">sort</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="n">inplace</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span></code>

</h2>


    <div class="doc doc-contents ">

      <p>Fold the profile about coord = crease.</p>
<p>WARNING: if properties have been calculated prior to folding, they may no
longer be correct.</p>
<p>For example, electric fields calculated by integrating charge profiles,
will have a different sign in each part of the box.</p>
<p>To deal with this they should be inverted based on the sign of the coordiante.</p>


<p><span class="doc-section-title">Parameters:</span></p>
    <table>
      <thead>
        <tr>
          <th>Name</th>
          <th>Type</th>
          <th>Description</th>
          <th>Default</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td><code>crease</code></td>
            <td>
            </td>
            <td>
              <div class="doc-md-description">
                <pre><code>Position along folded coordinate to fold about
</code></pre>
              </div>
            </td>
            <td>
                  <code>0.0</code>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td><code>coord_i</code></td>
            <td>
                  <code>int -</code>
            </td>
            <td>
              <div class="doc-md-description">
                <pre><code>The index of the self.coord_cols list. Default is 0, the first coord
</code></pre>
              </div>
            </td>
            <td>
                  <code>0</code>
            </td>
          </tr>
      </tbody>
    </table>

            <details class="quote">
              <summary>Source code in <code>thermotar/chunk.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">288</span>
<span class="normal">289</span>
<span class="normal">290</span>
<span class="normal">291</span>
<span class="normal">292</span>
<span class="normal">293</span>
<span class="normal">294</span>
<span class="normal">295</span>
<span class="normal">296</span>
<span class="normal">297</span>
<span class="normal">298</span>
<span class="normal">299</span>
<span class="normal">300</span>
<span class="normal">301</span>
<span class="normal">302</span>
<span class="normal">303</span>
<span class="normal">304</span>
<span class="normal">305</span>
<span class="normal">306</span>
<span class="normal">307</span>
<span class="normal">308</span>
<span class="normal">309</span>
<span class="normal">310</span>
<span class="normal">311</span>
<span class="normal">312</span>
<span class="normal">313</span>
<span class="normal">314</span>
<span class="normal">315</span>
<span class="normal">316</span>
<span class="normal">317</span>
<span class="normal">318</span>
<span class="normal">319</span>
<span class="normal">320</span>
<span class="normal">321</span>
<span class="normal">322</span>
<span class="normal">323</span>
<span class="normal">324</span>
<span class="normal">325</span>
<span class="normal">326</span>
<span class="normal">327</span>
<span class="normal">328</span>
<span class="normal">329</span>
<span class="normal">330</span>
<span class="normal">331</span>
<span class="normal">332</span>
<span class="normal">333</span>
<span class="normal">334</span>
<span class="normal">335</span>
<span class="normal">336</span>
<span class="normal">337</span>
<span class="normal">338</span>
<span class="normal">339</span>
<span class="normal">340</span>
<span class="normal">341</span>
<span class="normal">342</span>
<span class="normal">343</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span> <span class="nf">fold</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">crease</span><span class="o">=</span><span class="mf">0.0</span><span class="p">,</span> <span class="n">coord</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">coord_i</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="mi">0</span><span class="p">,</span> <span class="n">sort</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="n">inplace</span><span class="o">=</span><span class="kc">True</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Fold the profile about coord = crease.</span>

<span class="sd">    WARNING: if properties have been calculated prior to folding, they may no</span>
<span class="sd">    longer be correct.</span>

<span class="sd">    For example, electric fields calculated by integrating charge profiles,</span>
<span class="sd">    will have a different sign in each part of the box.</span>

<span class="sd">    To deal with this they should be inverted based on the sign of the coordiante.</span>

<span class="sd">    Parameters</span>
<span class="sd">    ----------</span>
<span class="sd">    crease: -</span>
<span class="sd">            Position along folded coordinate to fold about</span>

<span class="sd">    coord_i : int -</span>
<span class="sd">            The index of the self.coord_cols list. Default is 0, the first coord</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">if</span> <span class="n">coord</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
        <span class="n">coord_name</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">coord_cols</span><span class="p">[</span><span class="n">coord_i</span><span class="p">]</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="n">coord_name</span> <span class="o">=</span> <span class="n">coord</span>

    <span class="k">if</span> <span class="p">(</span><span class="n">crease</span> <span class="o">==</span> <span class="mi">0</span><span class="p">)</span> <span class="ow">and</span> <span class="bp">self</span><span class="o">.</span><span class="n">centred</span><span class="p">:</span>
        <span class="c1"># don&#39;t bother finding fold line, just go straight to folding!!!</span>
        <span class="c1"># in this case fold by making all negative and</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">data</span><span class="p">[</span><span class="n">coord_name</span><span class="p">]</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">absolute</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">data</span><span class="p">[</span><span class="n">coord_name</span><span class="p">])</span>
    <span class="k">elif</span> <span class="n">crease</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
        <span class="c1"># if the crease is located at coord = 0, but not already centred then - centres</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">centre</span><span class="p">(</span><span class="n">coord</span><span class="o">=</span><span class="n">coord_name</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">data</span><span class="p">[</span><span class="n">coord_name</span><span class="p">]</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">absolute</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">data</span><span class="p">[</span><span class="n">coord_name</span><span class="p">])</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="c1"># folding about some other value</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">data</span><span class="p">[</span><span class="n">coord_name</span><span class="p">]</span> <span class="o">-=</span> <span class="p">(</span>
            <span class="n">crease</span>  <span class="c1"># set origin to the value to be creased about</span>
        <span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">data</span><span class="p">[</span><span class="n">coord_name</span><span class="p">]</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">absolute</span><span class="p">(</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">data</span><span class="p">[</span><span class="n">coord_name</span><span class="p">]</span>
        <span class="p">)</span>  <span class="c1"># get absolute value</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">data</span><span class="p">[</span><span class="n">coord_name</span><span class="p">]</span> <span class="o">+=</span> <span class="p">(</span>
            <span class="n">crease</span>  <span class="c1"># add the crease value back so still starts at this value!</span>
        <span class="p">)</span>

    <span class="c1"># TODO Implement fully, even when not centred!</span>

    <span class="c1"># TODO auto sort ?</span>

    <span class="k">if</span> <span class="n">sort</span><span class="p">:</span>
        <span class="c1"># sorts the data by this column name</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">data</span><span class="o">.</span><span class="n">sort_values</span><span class="p">(</span>
            <span class="n">by</span><span class="o">=</span><span class="n">coord_name</span><span class="p">,</span> <span class="n">inplace</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">ignore_index</span><span class="o">=</span><span class="kc">True</span>
        <span class="p">)</span>  <span class="c1"># labels 0,1,2.... Needed for future integration/differentaion operations in numpy</span>

    <span class="k">pass</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h2 id="thermotar.chunk.Chunk.fold_and_ave" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">fold_and_ave</span><span class="p">(</span><span class="n">crease</span><span class="o">=</span><span class="mf">0.0</span><span class="p">,</span> <span class="n">coord</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">coord_i</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span> <span class="n">sort</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">bw</span><span class="o">=</span><span class="s1">&#39;auto&#39;</span><span class="p">)</span></code>

</h2>


    <div class="doc doc-contents ">

      <p>Fold the profile and average the two halves.</p>
<pre><code>WARNING: if properties have been calculated prior to folding,
they may no longer be correct, epsecially properties that invert under coordinate inversion (pseudoscalars)

For example, electric fields calculated by integrating charge profiles, will have a different sign in each part of the box.
</code></pre>


<p><span class="doc-section-title">Parameters:</span></p>
    <table>
      <thead>
        <tr>
          <th>Name</th>
          <th>Type</th>
          <th>Description</th>
          <th>Default</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td><code>crease</code></td>
            <td>
            </td>
            <td>
              <div class="doc-md-description">
                <pre><code>Position along folded coordinate to fold about
</code></pre>
              </div>
            </td>
            <td>
                  <code>0.0</code>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td><code>coord_i</code></td>
            <td>
                  <code>int</code>
            </td>
            <td>
              <div class="doc-md-description">
                <pre><code>The index of the self.coord_cols list. Default is 0, the first coord
if all, will fold all coordinates, but will only crease
</code></pre>
              </div>
            </td>
            <td>
                  <code>0</code>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td><code>bw</code></td>
            <td>
                  <code>str | float</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Averaging works by rebinning
If auto, tries to work out the original bin spacing and then groups by this
If not auto, specify the bin width in distance.</p>
              </div>
            </td>
            <td>
                  <code>&#39;auto&#39;</code>
            </td>
          </tr>
      </tbody>
    </table>

            <details class="quote">
              <summary>Source code in <code>thermotar/chunk.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">431</span>
<span class="normal">432</span>
<span class="normal">433</span>
<span class="normal">434</span>
<span class="normal">435</span>
<span class="normal">436</span>
<span class="normal">437</span>
<span class="normal">438</span>
<span class="normal">439</span>
<span class="normal">440</span>
<span class="normal">441</span>
<span class="normal">442</span>
<span class="normal">443</span>
<span class="normal">444</span>
<span class="normal">445</span>
<span class="normal">446</span>
<span class="normal">447</span>
<span class="normal">448</span>
<span class="normal">449</span>
<span class="normal">450</span>
<span class="normal">451</span>
<span class="normal">452</span>
<span class="normal">453</span>
<span class="normal">454</span>
<span class="normal">455</span>
<span class="normal">456</span>
<span class="normal">457</span>
<span class="normal">458</span>
<span class="normal">459</span>
<span class="normal">460</span>
<span class="normal">461</span>
<span class="normal">462</span>
<span class="normal">463</span>
<span class="normal">464</span>
<span class="normal">465</span>
<span class="normal">466</span>
<span class="normal">467</span>
<span class="normal">468</span>
<span class="normal">469</span>
<span class="normal">470</span>
<span class="normal">471</span>
<span class="normal">472</span>
<span class="normal">473</span>
<span class="normal">474</span>
<span class="normal">475</span>
<span class="normal">476</span>
<span class="normal">477</span>
<span class="normal">478</span>
<span class="normal">479</span>
<span class="normal">480</span>
<span class="normal">481</span>
<span class="normal">482</span>
<span class="normal">483</span>
<span class="normal">484</span>
<span class="normal">485</span>
<span class="normal">486</span>
<span class="normal">487</span>
<span class="normal">488</span>
<span class="normal">489</span>
<span class="normal">490</span>
<span class="normal">491</span>
<span class="normal">492</span>
<span class="normal">493</span>
<span class="normal">494</span>
<span class="normal">495</span>
<span class="normal">496</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span> <span class="nf">fold_and_ave</span><span class="p">(</span>
    <span class="bp">self</span><span class="p">,</span> <span class="n">crease</span><span class="o">=</span><span class="mf">0.0</span><span class="p">,</span> <span class="n">coord</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">coord_i</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span> <span class="n">sort</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">bw</span><span class="p">:</span> <span class="nb">str</span> <span class="o">|</span> <span class="nb">float</span> <span class="o">=</span> <span class="s2">&quot;auto&quot;</span>
<span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Fold the profile and average the two halves.</span>

<span class="sd">        WARNING: if properties have been calculated prior to folding,</span>
<span class="sd">        they may no longer be correct, epsecially properties that invert under coordinate inversion (pseudoscalars)</span>

<span class="sd">        For example, electric fields calculated by integrating charge profiles, will have a different sign in each part of the box.</span>

<span class="sd">    Parameters</span>
<span class="sd">    ----------</span>
<span class="sd">    crease:</span>
<span class="sd">            Position along folded coordinate to fold about</span>

<span class="sd">    coord_i : int</span>
<span class="sd">            The index of the self.coord_cols list. Default is 0, the first coord</span>
<span class="sd">            if all, will fold all coordinates, but will only crease</span>

<span class="sd">    bw:</span>
<span class="sd">        Averaging works by rebinning</span>
<span class="sd">        If auto, tries to work out the original bin spacing and then groups by this</span>
<span class="sd">        If not auto, specify the bin width in distance.</span>

<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">if</span> <span class="n">coord</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
        <span class="k">if</span> <span class="n">coord_i</span> <span class="o">==</span> <span class="s2">&quot;all&quot;</span><span class="p">:</span>
            <span class="n">coord_names</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">coord_cols</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">coord_names</span> <span class="o">=</span> <span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">coord_cols</span><span class="p">[</span><span class="n">coord_i</span><span class="p">]]</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="n">coord_names</span> <span class="o">=</span> <span class="p">[</span><span class="n">coord</span><span class="p">]</span>

    <span class="k">if</span> <span class="n">crease</span> <span class="o">==</span> <span class="mf">0.0</span> <span class="ow">and</span> <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">centred</span><span class="p">:</span>
        <span class="c1"># if the crease is located at coord = 0, but not already centred then - centres</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">centre</span><span class="p">(</span><span class="n">coord</span><span class="o">=</span><span class="n">coord_names</span><span class="p">)</span>

    <span class="n">df</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">data</span><span class="o">.</span><span class="n">copy</span><span class="p">()</span>

    <span class="n">coord1</span> <span class="o">=</span> <span class="n">df</span><span class="p">[</span><span class="n">coord_names</span><span class="p">[</span><span class="mi">0</span><span class="p">]]</span>

    <span class="k">if</span> <span class="n">bw</span> <span class="o">==</span> <span class="s2">&quot;auto&quot;</span><span class="p">:</span>
        <span class="n">bw</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">abs</span><span class="p">(</span>
            <span class="n">coord1</span><span class="o">.</span><span class="n">iloc</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span> <span class="o">-</span> <span class="n">coord1</span><span class="o">.</span><span class="n">iloc</span><span class="p">[</span><span class="o">-</span><span class="mi">2</span><span class="p">]</span>
        <span class="p">)</span>  <span class="c1"># if auto work out from the difference of the last 2 points of the coord</span>

    <span class="c1"># # only index by the first coord,but flip all?</span>
    <span class="c1"># select_a = (df[coord_names[0]] &gt;=  0)</span>
    <span class="c1"># select_b = ~select_a</span>

    <span class="c1"># df_a = df.loc[select_a].sort_values(by = coord_names[0] ,inplace = True,ignore_index = True)</span>
    <span class="c1"># df_b = df.loc[select_b]</span>
    <span class="c1"># df_b[coord_names]=df_b[coord_names].abs()</span>
    <span class="c1"># df_b.sort_values(by = coord_names[0] ,inplace = True,ignore_index = True)</span>

    <span class="c1"># df_ave = pd.concat({&#39;a&#39;:df_a,&#39;b&#39;:df_b}).mean(level=1)</span>

    <span class="c1"># fold the df</span>
    <span class="n">df</span><span class="p">[</span><span class="n">coord_names</span><span class="p">]</span> <span class="o">=</span> <span class="p">(</span>
        <span class="n">np</span><span class="o">.</span><span class="n">abs</span><span class="p">(</span><span class="n">df</span><span class="p">[</span><span class="n">coord_names</span><span class="p">]</span> <span class="o">-</span> <span class="n">crease</span><span class="p">)</span> <span class="o">+</span> <span class="n">crease</span>
    <span class="p">)</span>  <span class="c1"># assumes already centred for now</span>
    <span class="n">df_ave</span> <span class="o">=</span> <span class="n">df_utils</span><span class="o">.</span><span class="n">rebin</span><span class="p">(</span><span class="n">df</span><span class="p">,</span> <span class="n">coord_names</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">bw</span><span class="p">)</span><span class="o">.</span><span class="n">sort_values</span><span class="p">(</span>
        <span class="n">coord_names</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
    <span class="p">)</span>  <span class="c1"># performing the rebinning # then sort by the coord</span>

    <span class="k">return</span> <span class="n">df_ave</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h2 id="thermotar.chunk.Chunk.moment" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">moment</span><span class="p">(</span><span class="n">coord</span><span class="p">,</span> <span class="n">weighting</span><span class="p">,</span> <span class="n">order</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span></code>

</h2>


    <div class="doc doc-contents ">

      <p>Calculate the specified moment of the coordinate, weighted by a named property</p>

            <details class="quote">
              <summary>Source code in <code>thermotar/chunk.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">255</span>
<span class="normal">256</span>
<span class="normal">257</span>
<span class="normal">258</span>
<span class="normal">259</span>
<span class="normal">260</span>
<span class="normal">261</span>
<span class="normal">262</span>
<span class="normal">263</span>
<span class="normal">264</span>
<span class="normal">265</span>
<span class="normal">266</span>
<span class="normal">267</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span> <span class="nf">moment</span><span class="p">(</span>
    <span class="bp">self</span><span class="p">,</span>
    <span class="n">coord</span><span class="p">,</span>
    <span class="n">weighting</span><span class="p">,</span>
    <span class="n">order</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span>
<span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Calculate the specified moment of the coordinate, weighted by a named property&quot;&quot;&quot;</span>
    <span class="n">coords</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">data</span><span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">choose_coordinate</span><span class="p">(</span><span class="n">coord</span><span class="p">)]</span><span class="o">.</span><span class="n">T</span>

    <span class="n">integrand</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">data</span><span class="p">[</span><span class="n">weighting</span><span class="p">]</span> <span class="o">*</span> <span class="n">coords</span><span class="o">**</span><span class="n">order</span>
    <span class="n">normaliser</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">trapz</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">data</span><span class="p">[</span><span class="n">weighting</span><span class="p">],</span> <span class="n">coords</span><span class="p">)</span>

    <span class="k">return</span> <span class="n">np</span><span class="o">.</span><span class="n">trapz</span><span class="p">(</span><span class="n">integrand</span><span class="p">,</span> <span class="n">coords</span><span class="p">)</span> <span class="o">/</span> <span class="n">normaliser</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h2 id="thermotar.chunk.Chunk.nearest" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">nearest</span><span class="p">(</span><span class="nb">property</span><span class="p">,</span> <span class="n">value</span><span class="p">,</span> <span class="n">coord</span><span class="o">=</span><span class="mi">0</span><span class="p">)</span></code>

</h2>


    <div class="doc doc-contents ">

      <p>Return the index for which property is closest to <code>value</code>.</p>
<p>To do, return the actual row of properties??????</p>
<p>This way if nan - make a nan list</p>

            <details class="quote">
              <summary>Source code in <code>thermotar/chunk.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">149</span>
<span class="normal">150</span>
<span class="normal">151</span>
<span class="normal">152</span>
<span class="normal">153</span>
<span class="normal">154</span>
<span class="normal">155</span>
<span class="normal">156</span>
<span class="normal">157</span>
<span class="normal">158</span>
<span class="normal">159</span>
<span class="normal">160</span>
<span class="normal">161</span>
<span class="normal">162</span>
<span class="normal">163</span>
<span class="normal">164</span>
<span class="normal">165</span>
<span class="normal">166</span>
<span class="normal">167</span>
<span class="normal">168</span>
<span class="normal">169</span>
<span class="normal">170</span>
<span class="normal">171</span>
<span class="normal">172</span>
<span class="normal">173</span>
<span class="normal">174</span>
<span class="normal">175</span>
<span class="normal">176</span>
<span class="normal">177</span>
<span class="normal">178</span>
<span class="normal">179</span>
<span class="normal">180</span>
<span class="normal">181</span>
<span class="normal">182</span>
<span class="normal">183</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span> <span class="nf">nearest</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="nb">property</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span> <span class="n">value</span><span class="p">:</span> <span class="nb">float</span><span class="p">,</span> <span class="n">coord</span><span class="o">=</span><span class="mi">0</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Return the index for which property is closest to `value`.</span>

<span class="sd">    To do, return the actual row of properties??????</span>

<span class="sd">    This way if nan - make a nan list</span>

<span class="sd">    &quot;&quot;&quot;</span>
    <span class="c1"># TODO: Find out where this method is used and understand what on earth it does</span>
    <span class="n">coord</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">data</span><span class="p">[</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">coord_cols</span><span class="p">[</span><span class="n">coord</span><span class="p">]</span>
    <span class="p">]</span>  <span class="c1"># select coordinate column for which to find nearsest in each side</span>

    <span class="n">prop</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">data</span><span class="p">[</span><span class="nb">property</span><span class="p">]</span>
    <span class="c1"># if each half, find the index in each half of the simulation box</span>

    <span class="n">left</span> <span class="o">=</span> <span class="n">prop</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="n">coord</span> <span class="o">&lt;</span> <span class="mi">0</span><span class="p">]</span>
    <span class="n">right</span> <span class="o">=</span> <span class="n">prop</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="n">coord</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">]</span>

    <span class="n">right_nearest_index</span> <span class="o">=</span> <span class="n">right</span><span class="o">.</span><span class="n">sub</span><span class="p">(</span><span class="n">value</span><span class="p">)</span><span class="o">.</span><span class="n">abs</span><span class="p">()</span><span class="o">.</span><span class="n">idxmin</span><span class="p">()</span>

    <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">left</span><span class="o">.</span><span class="n">index</span><span class="p">)</span> <span class="o">!=</span> <span class="mi">0</span><span class="p">:</span>
        <span class="n">left_nearest_index</span> <span class="o">=</span> <span class="n">left</span><span class="o">.</span><span class="n">sub</span><span class="p">(</span><span class="n">value</span><span class="p">)</span><span class="o">.</span><span class="n">abs</span><span class="p">()</span><span class="o">.</span><span class="n">idxmin</span><span class="p">()</span>
        <span class="n">indexes</span> <span class="o">=</span> <span class="p">[</span><span class="n">left_nearest_index</span><span class="p">,</span> <span class="n">right_nearest_index</span><span class="p">]</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="n">indexes</span> <span class="o">=</span> <span class="p">[</span><span class="n">right_nearest_index</span><span class="p">]</span>

    <span class="k">try</span><span class="p">:</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">data</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="n">indexes</span><span class="p">]</span><span class="o">.</span><span class="n">copy</span><span class="p">()</span>
    <span class="k">except</span> <span class="ne">KeyError</span><span class="p">:</span>  <span class="c1"># just create an empty row</span>
        <span class="n">row_copy</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">data</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span>
            <span class="p">(</span><span class="mi">0</span><span class="p">,),</span> <span class="p">:</span>
        <span class="p">]</span><span class="o">.</span><span class="n">copy</span><span class="p">()</span>  <span class="c1"># janky indexing makes it a df rather than a series</span>
        <span class="n">row_copy</span><span class="o">.</span><span class="n">loc</span><span class="p">[:]</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">nan</span>
        <span class="k">return</span> <span class="n">row_copy</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h2 id="thermotar.chunk.Chunk.parity" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">parity</span><span class="p">(</span><span class="n">prop</span><span class="p">,</span> <span class="n">coord</span><span class="o">=</span><span class="mi">0</span><span class="p">)</span></code>

</h2>


    <div class="doc doc-contents ">

      <p>Multiplies a property by the sign of the coordinate.</p>
<p>Should only be applied to properties that are pseudo scalars,  i.e. change
sign under coordinate inversion, so that upon folding and averaging
properties are correct.</p>

            <details class="quote">
              <summary>Source code in <code>thermotar/chunk.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">235</span>
<span class="normal">236</span>
<span class="normal">237</span>
<span class="normal">238</span>
<span class="normal">239</span>
<span class="normal">240</span>
<span class="normal">241</span>
<span class="normal">242</span>
<span class="normal">243</span>
<span class="normal">244</span>
<span class="normal">245</span>
<span class="normal">246</span>
<span class="normal">247</span>
<span class="normal">248</span>
<span class="normal">249</span>
<span class="normal">250</span>
<span class="normal">251</span>
<span class="normal">252</span>
<span class="normal">253</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span> <span class="nf">parity</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">prop</span><span class="p">,</span> <span class="n">coord</span><span class="o">=</span><span class="mi">0</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Multiplies a property by the sign of the coordinate.</span>

<span class="sd">    Should only be applied to properties that are pseudo scalars,  i.e. change</span>
<span class="sd">    sign under coordinate inversion, so that upon folding and averaging</span>
<span class="sd">    properties are correct.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="c1"># centre first</span>
    <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">coord</span><span class="p">,</span> <span class="nb">int</span><span class="p">):</span>
        <span class="n">coord</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">coord_cols</span><span class="p">[</span><span class="n">coord</span><span class="p">]</span>
    <span class="k">if</span> <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">centred</span><span class="p">:</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">centre</span><span class="p">()</span>

    <span class="bp">self</span><span class="o">.</span><span class="n">data</span><span class="p">[</span><span class="n">prop</span> <span class="o">+</span> <span class="s2">&quot;_original&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">data</span><span class="p">[</span><span class="n">prop</span><span class="p">]</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">data</span><span class="p">[</span><span class="n">prop</span><span class="p">]</span> <span class="o">*=</span> <span class="n">np</span><span class="o">.</span><span class="n">sign</span><span class="p">(</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">data</span><span class="p">[</span><span class="n">coord</span><span class="p">]</span>
    <span class="p">)</span>  <span class="c1"># multiply by the sign of the coordinate column</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">raise_columns</span><span class="p">()</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h2 id="thermotar.chunk.Chunk.prop_grad" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">prop_grad</span><span class="p">(</span><span class="n">prop</span><span class="p">,</span> <span class="n">coord</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span></code>

</h2>


    <div class="doc doc-contents ">

      <p>Calculate the gradient of <code>prop</code> with respect to <code>coord</code>.</p>


<p><span class="doc-section-title">Parameters:</span></p>
    <table>
      <thead>
        <tr>
          <th>Name</th>
          <th>Type</th>
          <th>Description</th>
          <th>Default</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td><code>prop</code></td>
            <td>
                  <code>str</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Which property the gradient of is calculated</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td><code>coord</code></td>
            <td>
                  <code>str</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Which property is used for the coordinate.</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td><code>kwargs</code></td>
            <td>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Keyword arguments to pass to <code>np.gradient</code></p>
              </div>
            </td>
            <td>
                  <code>{}</code>
            </td>
          </tr>
      </tbody>
    </table>

            <details class="quote">
              <summary>Source code in <code>thermotar/chunk.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">130</span>
<span class="normal">131</span>
<span class="normal">132</span>
<span class="normal">133</span>
<span class="normal">134</span>
<span class="normal">135</span>
<span class="normal">136</span>
<span class="normal">137</span>
<span class="normal">138</span>
<span class="normal">139</span>
<span class="normal">140</span>
<span class="normal">141</span>
<span class="normal">142</span>
<span class="normal">143</span>
<span class="normal">144</span>
<span class="normal">145</span>
<span class="normal">146</span>
<span class="normal">147</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span> <span class="nf">prop_grad</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">prop</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span> <span class="n">coord</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Calculate the gradient of `prop` with respect to `coord`.</span>

<span class="sd">    Parameters</span>
<span class="sd">    ----------</span>
<span class="sd">    prop:</span>
<span class="sd">        Which property the gradient of is calculated</span>
<span class="sd">    coord:</span>
<span class="sd">        Which property is used for the coordinate.</span>
<span class="sd">    kwargs:</span>
<span class="sd">        Keyword arguments to pass to `np.gradient`</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">df</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">data</span>

    <span class="n">df</span><span class="p">[</span><span class="n">prop</span> <span class="o">+</span> <span class="s2">&quot;_grad&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">gradient</span><span class="p">(</span><span class="n">df</span><span class="p">[</span><span class="n">prop</span><span class="p">],</span> <span class="n">df</span><span class="p">[</span><span class="n">coord</span><span class="p">],</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>

    <span class="c1"># updates the columns</span>
    <span class="n">df_utils</span><span class="o">.</span><span class="n">raise_columns</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h2 id="thermotar.chunk.Chunk.raise_columns" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">raise_columns</span><span class="p">()</span></code>

</h2>


    <div class="doc doc-contents ">

      <p>Raise columns from the df to be attributes.</p>

            <details class="quote">
              <summary>Source code in <code>thermotar/chunk.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">122</span>
<span class="normal">123</span>
<span class="normal">124</span>
<span class="normal">125</span>
<span class="normal">126</span>
<span class="normal">127</span>
<span class="normal">128</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span> <span class="nf">raise_columns</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Raise columns from the df to be attributes.&quot;&quot;&quot;</span>
    <span class="c1"># I have no clue how pandas does this automatically...</span>
    <span class="c1"># Maybe I need to make it so my objects can be indexed</span>
    <span class="c1"># and in doing that for assignment, the attributes can be raised up</span>
    <span class="c1"># TODO : Something with above??</span>
    <span class="n">df_utils</span><span class="o">.</span><span class="n">raise_columns</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h2 id="thermotar.chunk.Chunk.rebin" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">rebin</span><span class="p">(</span><span class="n">coord</span><span class="p">,</span> <span class="n">bw</span><span class="o">=</span><span class="mf">0.25</span><span class="p">,</span> <span class="n">bins</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">nbins</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">mode</span><span class="o">=</span><span class="s1">&#39;average&#39;</span><span class="p">,</span> <span class="n">inplace</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="n">new_coord_loc</span><span class="o">=</span><span class="s1">&#39;mid&#39;</span><span class="p">,</span> <span class="n">weights</span><span class="o">=</span><span class="kc">None</span><span class="p">)</span></code>

</h2>


    <div class="doc doc-contents ">

      <p>Rebin the data based on coordinates for a given new bin width.</p>
<p>Default is to perform averages over these bins.
Could also add weightings for these averages</p>


<p><span class="doc-section-title">Parameters:</span></p>
    <table>
      <thead>
        <tr>
          <th>Name</th>
          <th>Type</th>
          <th>Description</th>
          <th>Default</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td><code>coord</code></td>
            <td>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Column name of the coordinate to create the bins from</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td><code>nbins</code></td>
            <td>
            </td>
            <td>
              <div class="doc-md-description">
                <p>None, int, or array of ints. Number of bins for each binning dimension.
Currently only supported for 2D bins.</p>
              </div>
            </td>
            <td>
                  <code>None</code>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td><code>new_coord_loc</code></td>
            <td>
            </td>
            <td>
              <div class="doc-md-description">
                <p>"mid" (default), "left" or "right" position of new coordinate,
when set manually rather than from average. Currently only for 2D bins</p>
              </div>
            </td>
            <td>
                  <code>&#39;mid&#39;</code>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td><code>inplace</code></td>
            <td>
                  <code>bool</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>if True, overwrites the .data method, else just returns the data frame.</p>
              </div>
            </td>
            <td>
                  <code>False</code>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td><code>weights</code></td>
            <td>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Column label for performing a weighted average,
only used if mode is "average" or "mean"</p>
              </div>
            </td>
            <td>
                  <code>None</code>
            </td>
          </tr>
      </tbody>
    </table>

            <details class="quote">
              <summary>Source code in <code>thermotar/chunk.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">345</span>
<span class="normal">346</span>
<span class="normal">347</span>
<span class="normal">348</span>
<span class="normal">349</span>
<span class="normal">350</span>
<span class="normal">351</span>
<span class="normal">352</span>
<span class="normal">353</span>
<span class="normal">354</span>
<span class="normal">355</span>
<span class="normal">356</span>
<span class="normal">357</span>
<span class="normal">358</span>
<span class="normal">359</span>
<span class="normal">360</span>
<span class="normal">361</span>
<span class="normal">362</span>
<span class="normal">363</span>
<span class="normal">364</span>
<span class="normal">365</span>
<span class="normal">366</span>
<span class="normal">367</span>
<span class="normal">368</span>
<span class="normal">369</span>
<span class="normal">370</span>
<span class="normal">371</span>
<span class="normal">372</span>
<span class="normal">373</span>
<span class="normal">374</span>
<span class="normal">375</span>
<span class="normal">376</span>
<span class="normal">377</span>
<span class="normal">378</span>
<span class="normal">379</span>
<span class="normal">380</span>
<span class="normal">381</span>
<span class="normal">382</span>
<span class="normal">383</span>
<span class="normal">384</span>
<span class="normal">385</span>
<span class="normal">386</span>
<span class="normal">387</span>
<span class="normal">388</span>
<span class="normal">389</span>
<span class="normal">390</span>
<span class="normal">391</span>
<span class="normal">392</span>
<span class="normal">393</span>
<span class="normal">394</span>
<span class="normal">395</span>
<span class="normal">396</span>
<span class="normal">397</span>
<span class="normal">398</span>
<span class="normal">399</span>
<span class="normal">400</span>
<span class="normal">401</span>
<span class="normal">402</span>
<span class="normal">403</span>
<span class="normal">404</span>
<span class="normal">405</span>
<span class="normal">406</span>
<span class="normal">407</span>
<span class="normal">408</span>
<span class="normal">409</span>
<span class="normal">410</span>
<span class="normal">411</span>
<span class="normal">412</span>
<span class="normal">413</span>
<span class="normal">414</span>
<span class="normal">415</span>
<span class="normal">416</span>
<span class="normal">417</span>
<span class="normal">418</span>
<span class="normal">419</span>
<span class="normal">420</span>
<span class="normal">421</span>
<span class="normal">422</span>
<span class="normal">423</span>
<span class="normal">424</span>
<span class="normal">425</span>
<span class="normal">426</span>
<span class="normal">427</span>
<span class="normal">428</span>
<span class="normal">429</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span> <span class="nf">rebin</span><span class="p">(</span>
    <span class="bp">self</span><span class="p">,</span>
    <span class="n">coord</span><span class="p">,</span>
    <span class="n">bw</span><span class="o">=</span><span class="mf">0.25</span><span class="p">,</span>
    <span class="n">bins</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
    <span class="n">nbins</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
    <span class="n">mode</span><span class="o">=</span><span class="s2">&quot;average&quot;</span><span class="p">,</span>
    <span class="n">inplace</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span>
    <span class="n">new_coord_loc</span><span class="o">=</span><span class="s2">&quot;mid&quot;</span><span class="p">,</span>
    <span class="n">weights</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
<span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Rebin the data based on coordinates for a given new bin width.</span>

<span class="sd">    Default is to perform averages over these bins.</span>
<span class="sd">    Could also add weightings for these averages</span>

<span class="sd">    Parameters</span>
<span class="sd">    ----------</span>
<span class="sd">    coord:</span>
<span class="sd">        Column name of the coordinate to create the bins from</span>

<span class="sd">    nbins:</span>
<span class="sd">        None, int, or array of ints. Number of bins for each binning dimension.</span>
<span class="sd">        Currently only supported for 2D bins.</span>

<span class="sd">    new_coord_loc:</span>
<span class="sd">        &quot;mid&quot; (default), &quot;left&quot; or &quot;right&quot; position of new coordinate,</span>
<span class="sd">        when set manually rather than from average. Currently only for 2D bins</span>

<span class="sd">    inplace : bool</span>
<span class="sd">        if True, overwrites the .data method, else just returns the data frame.</span>

<span class="sd">    weights:</span>
<span class="sd">        Column label for performing a weighted average,</span>
<span class="sd">        only used if mode is &quot;average&quot; or &quot;mean&quot;</span>

<span class="sd">    &quot;&quot;&quot;</span>
    <span class="c1"># TODO: - implement n_bins argument for 1d bins</span>
    <span class="n">df</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">data</span>

    <span class="c1"># Use multiple bins</span>
    <span class="k">if</span> <span class="n">np</span><span class="o">.</span><span class="n">iterable</span><span class="p">(</span><span class="n">coord</span><span class="p">)</span> <span class="ow">and</span> <span class="ow">not</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">coord</span><span class="p">,</span> <span class="nb">str</span><span class="p">):</span>
        <span class="n">number_coords</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="n">coord</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">number_coords</span> <span class="o">==</span> <span class="mi">2</span><span class="p">:</span>
            <span class="n">coord1</span><span class="p">,</span> <span class="n">coord2</span> <span class="o">=</span> <span class="n">coord</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">coord</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span>
            <span class="n">df_binned</span> <span class="o">=</span> <span class="n">df_utils</span><span class="o">.</span><span class="n">rebin_2D</span><span class="p">(</span>
                <span class="n">df</span><span class="p">,</span>
                <span class="n">coord1</span><span class="p">,</span>
                <span class="n">coord2</span><span class="p">,</span>
                <span class="n">bw</span><span class="o">=</span><span class="n">bw</span><span class="p">,</span>
                <span class="n">bins</span><span class="o">=</span><span class="n">bins</span><span class="p">,</span>
                <span class="n">mode</span><span class="o">=</span><span class="n">mode</span><span class="p">,</span>
                <span class="n">nbins</span><span class="o">=</span><span class="n">nbins</span><span class="p">,</span>
                <span class="n">new_coord_loc</span><span class="o">=</span><span class="n">new_coord_loc</span><span class="p">,</span>
                <span class="n">weight_col</span><span class="o">=</span><span class="n">weights</span><span class="p">,</span>
            <span class="p">)</span>
        <span class="k">elif</span> <span class="n">np</span><span class="o">.</span><span class="n">number</span> <span class="o">&gt;=</span> <span class="mi">3</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">NotImplementedError</span><span class="p">(</span>
                <span class="s2">&quot;Binning in more than two dimensions not yet supported&quot;</span>
            <span class="p">)</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="n">df_binned</span> <span class="o">=</span> <span class="n">df_utils</span><span class="o">.</span><span class="n">rebin</span><span class="p">(</span>
            <span class="n">df</span><span class="p">,</span> <span class="n">coord</span><span class="p">,</span> <span class="n">bw</span><span class="o">=</span><span class="n">bw</span><span class="p">,</span> <span class="n">mode</span><span class="o">=</span><span class="n">mode</span><span class="p">,</span> <span class="n">weight_col</span><span class="o">=</span><span class="n">weights</span><span class="p">,</span> <span class="n">bins</span><span class="o">=</span><span class="n">bins</span>
        <span class="p">)</span>
    <span class="c1"># coord_max = df[coord].max()</span>
    <span class="c1"># coord_min = df[coord].min() # finding min and max so it works with gfolded data</span>

    <span class="c1"># n_bins = (coord_max-coord_min) // bw #double divide is floor division</span>
    <span class="c1"># n_bins = int(n_bins)</span>

    <span class="c1"># bins = pd.cut(df[coord],n_bins)</span>

    <span class="c1"># df_grouped = df.groupby(bins)</span>

    <span class="c1"># if mode == &#39;average&#39; or mode == &#39;mean&#39;:</span>
    <span class="c1">#     df_binned = df_grouped.mean()</span>
    <span class="c1"># else:</span>
    <span class="c1">#     df_binned = df_grouped.sum()</span>

    <span class="c1"># TODO:  Why is df_binned possibly unbound?</span>
    <span class="k">if</span> <span class="n">inplace</span><span class="p">:</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">data</span> <span class="o">=</span> <span class="n">df_binned</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="k">return</span> <span class="n">df_binned</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>



  </div>

    </div>

</div><h2 id="multichunk">MultiChunk</h2>
<p>An extended Version of Chunk
</p>


<div class="doc doc-object doc-class">



<a id="thermotar.multichunk.MultiChunk"></a>
    <div class="doc doc-contents first">


              <details class="quote">
                <summary>Source code in <code>thermotar/multichunk.py</code></summary>
                <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">  8</span>
<span class="normal">  9</span>
<span class="normal"> 10</span>
<span class="normal"> 11</span>
<span class="normal"> 12</span>
<span class="normal"> 13</span>
<span class="normal"> 14</span>
<span class="normal"> 15</span>
<span class="normal"> 16</span>
<span class="normal"> 17</span>
<span class="normal"> 18</span>
<span class="normal"> 19</span>
<span class="normal"> 20</span>
<span class="normal"> 21</span>
<span class="normal"> 22</span>
<span class="normal"> 23</span>
<span class="normal"> 24</span>
<span class="normal"> 25</span>
<span class="normal"> 26</span>
<span class="normal"> 27</span>
<span class="normal"> 28</span>
<span class="normal"> 29</span>
<span class="normal"> 30</span>
<span class="normal"> 31</span>
<span class="normal"> 32</span>
<span class="normal"> 33</span>
<span class="normal"> 34</span>
<span class="normal"> 35</span>
<span class="normal"> 36</span>
<span class="normal"> 37</span>
<span class="normal"> 38</span>
<span class="normal"> 39</span>
<span class="normal"> 40</span>
<span class="normal"> 41</span>
<span class="normal"> 42</span>
<span class="normal"> 43</span>
<span class="normal"> 44</span>
<span class="normal"> 45</span>
<span class="normal"> 46</span>
<span class="normal"> 47</span>
<span class="normal"> 48</span>
<span class="normal"> 49</span>
<span class="normal"> 50</span>
<span class="normal"> 51</span>
<span class="normal"> 52</span>
<span class="normal"> 53</span>
<span class="normal"> 54</span>
<span class="normal"> 55</span>
<span class="normal"> 56</span>
<span class="normal"> 57</span>
<span class="normal"> 58</span>
<span class="normal"> 59</span>
<span class="normal"> 60</span>
<span class="normal"> 61</span>
<span class="normal"> 62</span>
<span class="normal"> 63</span>
<span class="normal"> 64</span>
<span class="normal"> 65</span>
<span class="normal"> 66</span>
<span class="normal"> 67</span>
<span class="normal"> 68</span>
<span class="normal"> 69</span>
<span class="normal"> 70</span>
<span class="normal"> 71</span>
<span class="normal"> 72</span>
<span class="normal"> 73</span>
<span class="normal"> 74</span>
<span class="normal"> 75</span>
<span class="normal"> 76</span>
<span class="normal"> 77</span>
<span class="normal"> 78</span>
<span class="normal"> 79</span>
<span class="normal"> 80</span>
<span class="normal"> 81</span>
<span class="normal"> 82</span>
<span class="normal"> 83</span>
<span class="normal"> 84</span>
<span class="normal"> 85</span>
<span class="normal"> 86</span>
<span class="normal"> 87</span>
<span class="normal"> 88</span>
<span class="normal"> 89</span>
<span class="normal"> 90</span>
<span class="normal"> 91</span>
<span class="normal"> 92</span>
<span class="normal"> 93</span>
<span class="normal"> 94</span>
<span class="normal"> 95</span>
<span class="normal"> 96</span>
<span class="normal"> 97</span>
<span class="normal"> 98</span>
<span class="normal"> 99</span>
<span class="normal">100</span>
<span class="normal">101</span>
<span class="normal">102</span>
<span class="normal">103</span>
<span class="normal">104</span>
<span class="normal">105</span>
<span class="normal">106</span>
<span class="normal">107</span>
<span class="normal">108</span>
<span class="normal">109</span>
<span class="normal">110</span>
<span class="normal">111</span>
<span class="normal">112</span>
<span class="normal">113</span>
<span class="normal">114</span>
<span class="normal">115</span>
<span class="normal">116</span>
<span class="normal">117</span>
<span class="normal">118</span>
<span class="normal">119</span>
<span class="normal">120</span>
<span class="normal">121</span>
<span class="normal">122</span>
<span class="normal">123</span>
<span class="normal">124</span>
<span class="normal">125</span>
<span class="normal">126</span>
<span class="normal">127</span>
<span class="normal">128</span>
<span class="normal">129</span>
<span class="normal">130</span>
<span class="normal">131</span>
<span class="normal">132</span>
<span class="normal">133</span>
<span class="normal">134</span>
<span class="normal">135</span>
<span class="normal">136</span>
<span class="normal">137</span>
<span class="normal">138</span>
<span class="normal">139</span>
<span class="normal">140</span>
<span class="normal">141</span>
<span class="normal">142</span>
<span class="normal">143</span>
<span class="normal">144</span>
<span class="normal">145</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">class</span> <span class="nc">MultiChunk</span><span class="p">:</span>
    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span>
        <span class="bp">self</span><span class="p">,</span>
        <span class="n">df</span><span class="p">,</span>
        <span class="n">file2</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
        <span class="n">CLEANUP</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
        <span class="n">coord_cols</span><span class="o">=</span><span class="p">[</span><span class="s2">&quot;Coord1&quot;</span><span class="p">,</span> <span class="s2">&quot;Coord2&quot;</span><span class="p">,</span> <span class="s2">&quot;Coord3&quot;</span><span class="p">,</span> <span class="s2">&quot;coord&quot;</span><span class="p">],</span>
        <span class="n">centred</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span>
        <span class="n">centered</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
        <span class="o">**</span><span class="n">kwargs</span><span class="p">,</span>
    <span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;thermo_file - string of log file location&quot;&quot;&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">data</span><span class="p">:</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span> <span class="o">=</span> <span class="n">df</span>

        <span class="c1"># clean up dataframe</span>

        <span class="c1"># apply strip_pref function to remove &#39;c_/f_/v_&#39; prefixes to all columns</span>
        <span class="k">if</span> <span class="n">CLEANUP</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">data</span><span class="o">.</span><span class="n">rename</span><span class="p">(</span><span class="n">columns</span><span class="o">=</span><span class="n">lmp_utils</span><span class="o">.</span><span class="n">strip_pref</span><span class="p">,</span> <span class="n">inplace</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">data</span><span class="o">.</span><span class="n">rename</span><span class="p">(</span><span class="n">columns</span><span class="o">=</span><span class="n">lmp_utils</span><span class="o">.</span><span class="n">drop_python_bad</span><span class="p">,</span> <span class="n">inplace</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
            <span class="c1"># todo merge columns into vectors</span>

        <span class="c1"># set the columns as attributes</span>
        <span class="k">for</span> <span class="n">col</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">data</span><span class="o">.</span><span class="n">columns</span><span class="p">:</span>
            <span class="c1"># setattr(self, col ,getattr(self.data, col))</span>
            <span class="c1"># has to be set to a method of the class</span>
            <span class="nb">setattr</span><span class="p">(</span>
                <span class="bp">self</span><span class="o">.</span><span class="vm">__class__</span><span class="p">,</span> <span class="n">col</span><span class="p">,</span> <span class="n">df_utils</span><span class="o">.</span><span class="n">raise_col</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">col</span><span class="p">)</span>
            <span class="p">)</span>  <span class="c1"># set attribute to this property object??</span>
        <span class="c1"># column names for the coordinates, up to 3</span>
        <span class="c1"># only those in the df are included, by finding intersect of sets.</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">coord_cols</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span><span class="nb">set</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">data</span><span class="o">.</span><span class="n">columns</span><span class="o">.</span><span class="n">to_list</span><span class="p">())</span> <span class="o">&amp;</span> <span class="nb">set</span><span class="p">(</span><span class="n">coord_cols</span><span class="p">))</span>
        <span class="k">if</span> <span class="n">centered</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">centred</span> <span class="o">=</span> <span class="n">centered</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">centred</span> <span class="o">=</span> <span class="n">centred</span>  <span class="c1"># Initialise assuming asymmetrical - to do implement a method to check this!!!!</span>

    <span class="k">def</span> <span class="nf">copy</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="n">new_chunk</span> <span class="o">=</span> <span class="n">MultiChunk</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">data</span><span class="o">.</span><span class="n">copy</span><span class="p">())</span>
        <span class="n">new_chunk</span><span class="o">.</span><span class="n">coord_cols</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">coord_cols</span>
        <span class="n">new_chunk</span><span class="o">.</span><span class="n">centred</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">centred</span>
        <span class="k">return</span> <span class="n">new_chunk</span>

    <span class="k">def</span> <span class="nf">zero_to_nan</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">val</span><span class="o">=</span><span class="mf">0.0</span><span class="p">,</span> <span class="n">col</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Replace an exact value specified by val with nan</span>
<span class="sd">        In columns col</span>
<span class="sd">        Improves averages</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="n">col</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">to_replace</span> <span class="o">=</span> <span class="p">{</span><span class="n">val</span><span class="p">:</span> <span class="n">np</span><span class="o">.</span><span class="n">nan</span><span class="p">}</span>
            <span class="n">value</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">nan</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">data</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">data</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="n">to_replace</span><span class="o">=</span><span class="n">to_replace</span><span class="p">)</span>
            <span class="k">return</span>
            <span class="c1"># self.data = self.data.replace(to_replace=)</span>
        <span class="k">elif</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">col</span><span class="p">,</span> <span class="nb">list</span><span class="p">):</span>
            <span class="n">to_replace</span> <span class="o">=</span> <span class="p">{</span><span class="n">column</span><span class="p">:</span> <span class="n">val</span> <span class="k">for</span> <span class="n">column</span> <span class="ow">in</span> <span class="n">col</span><span class="p">}</span>
            <span class="n">value</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">nan</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">to_replace</span> <span class="o">=</span> <span class="p">{</span><span class="n">col</span><span class="p">:</span> <span class="n">val</span><span class="p">}</span>
            <span class="n">value</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">nan</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">data</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">data</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="n">to_replace</span><span class="o">=</span><span class="n">to_replace</span><span class="p">,</span> <span class="n">value</span><span class="o">=</span><span class="n">value</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">zero_to_nan_return</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">val</span><span class="o">=</span><span class="mf">0.0</span><span class="p">,</span> <span class="n">col</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Replace an exact value specified by val with nan</span>
<span class="sd">        In columns col</span>
<span class="sd">        Improves averages</span>
<span class="sd">        Returns a new MultiChunk</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">new_chunk</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">copy</span><span class="p">()</span>
        <span class="n">new_chunk</span><span class="o">.</span><span class="n">zero_to_nan</span><span class="p">(</span><span class="n">val</span><span class="o">=</span><span class="n">val</span><span class="p">,</span> <span class="n">col</span><span class="o">=</span><span class="n">col</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">new_chunk</span>

    <span class="k">def</span> <span class="nf">thresh_to_nan_inplace</span><span class="p">(</span>
        <span class="bp">self</span><span class="p">,</span>
        <span class="n">col</span><span class="p">,</span>
        <span class="n">thresh</span><span class="o">=</span><span class="mf">0.0</span><span class="p">,</span>
    <span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Replace values below a threshold with Nan</span>
<span class="sd">        In columns col</span>
<span class="sd">        Improves averages</span>

<span class="sd">        TODO actually implement what this says, not just removing the rows.....</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">df</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">data</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">data</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">data</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="n">df</span><span class="p">[</span><span class="n">col</span><span class="p">]</span> <span class="o">&gt;=</span> <span class="n">thresh</span><span class="p">]</span>

    <span class="k">def</span> <span class="nf">thersh_to_nan_return</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">col</span><span class="p">,</span> <span class="n">thresh</span><span class="o">=</span><span class="mf">0.0</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Replace values below a threshold with Nan</span>
<span class="sd">        In columns col(ums)</span>
<span class="sd">        Improves averages</span>
<span class="sd">        Returns a new object</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="c1"># TODO use views or something instead, idk</span>
        <span class="c1"># TODO create a clone method for chunk/multichunk/ for the the &quot;DataHolder&quot; class...</span>
        <span class="n">new_chunk</span> <span class="o">=</span> <span class="n">MultiChunk</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">data</span><span class="o">.</span><span class="n">copy</span><span class="p">())</span>
        <span class="n">new_chunk</span><span class="o">.</span><span class="n">thresh_to_nan_inplace</span><span class="p">(</span><span class="n">col</span><span class="o">=</span><span class="n">col</span><span class="p">,</span> <span class="n">thresh</span><span class="o">=</span><span class="n">thresh</span><span class="p">)</span>

        <span class="k">return</span> <span class="n">new_chunk</span>

    <span class="k">def</span> <span class="nf">zero_to_nan_return</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">val</span><span class="o">=</span><span class="mf">0.0</span><span class="p">,</span> <span class="n">col</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Replace an exact value specified by val with nan</span>
<span class="sd">        In columns col</span>
<span class="sd">        Improves averages</span>
<span class="sd">        Same as zero_to_nan but creates a new obj</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="n">col</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="c1"># apply to all cols</span>
            <span class="k">return</span> <span class="n">MultiChunk</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">data</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="n">to_replace</span><span class="o">=</span><span class="p">{</span><span class="n">val</span><span class="p">:</span> <span class="n">np</span><span class="o">.</span><span class="n">nan</span><span class="p">})</span><span class="o">.</span><span class="n">copy</span><span class="p">())</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">return</span> <span class="n">MultiChunk</span><span class="p">(</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">data</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="n">to_replace</span><span class="o">=</span><span class="p">{</span><span class="n">col</span><span class="p">:</span> <span class="n">val</span><span class="p">},</span> <span class="n">value</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">nan</span><span class="p">)</span><span class="o">.</span><span class="n">copy</span><span class="p">()</span>
            <span class="p">)</span>

    <span class="k">def</span> <span class="nf">flatten_chunk</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">drop_na</span><span class="o">=</span><span class="kc">None</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Chunk</span><span class="p">:</span>
        <span class="n">df</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">data</span><span class="o">.</span><span class="n">groupby</span><span class="p">(</span><span class="n">level</span><span class="o">=</span><span class="p">(</span><span class="mi">3</span><span class="p">))</span><span class="o">.</span><span class="n">mean</span><span class="p">()</span>

        <span class="k">if</span> <span class="n">drop_na</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">df</span><span class="o">.</span><span class="n">dropna</span><span class="p">(</span><span class="n">how</span><span class="o">=</span><span class="n">drop_na</span><span class="p">,</span> <span class="n">inplace</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>

        <span class="k">return</span> <span class="n">Chunk</span><span class="p">(</span><span class="n">df</span><span class="p">)</span>

    <span class="nd">@staticmethod</span>
    <span class="k">def</span> <span class="nf">create_multi_chunks</span><span class="p">(</span><span class="n">fname</span><span class="p">,</span> <span class="o">*</span><span class="p">,</span> <span class="n">verbose</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="o">**</span><span class="n">read_csv_kwargs</span><span class="p">):</span>
        <span class="n">parser</span><span class="p">:</span> <span class="n">LMPChunksParser</span> <span class="o">=</span> <span class="n">parse_lmp_chunks</span><span class="p">(</span>
            <span class="n">fname</span><span class="p">,</span> <span class="n">verbose</span><span class="o">=</span><span class="n">verbose</span><span class="p">,</span> <span class="o">**</span><span class="n">read_csv_kwargs</span>
        <span class="p">)</span>

        <span class="k">if</span> <span class="n">verbose</span><span class="p">:</span>
            <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Smallest chunk:&quot;</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">min</span><span class="p">(</span><span class="n">parser</span><span class="o">.</span><span class="n">n_chunks</span><span class="p">))</span>
            <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Biggest chunk:&quot;</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">max</span><span class="p">(</span><span class="n">parser</span><span class="o">.</span><span class="n">n_chunks</span><span class="p">))</span>

        <span class="k">return</span> <span class="n">MultiChunk</span><span class="p">(</span><span class="n">parser</span><span class="o">.</span><span class="n">data</span><span class="p">)</span>
</code></pre></div></td></tr></table></div>
              </details>



  <div class="doc doc-children">









<div class="doc doc-object doc-function">


<h2 id="thermotar.multichunk.MultiChunk.__init__" class="doc doc-heading">
            <code class="highlight language-python"><span class="fm">__init__</span><span class="p">(</span><span class="n">df</span><span class="p">,</span> <span class="n">file2</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">CLEANUP</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">coord_cols</span><span class="o">=</span><span class="p">[</span><span class="s1">&#39;Coord1&#39;</span><span class="p">,</span> <span class="s1">&#39;Coord2&#39;</span><span class="p">,</span> <span class="s1">&#39;Coord3&#39;</span><span class="p">,</span> <span class="s1">&#39;coord&#39;</span><span class="p">],</span> <span class="n">centred</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="n">centered</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span></code>

</h2>


    <div class="doc doc-contents ">

      <p>thermo_file - string of log file location</p>

            <details class="quote">
              <summary>Source code in <code>thermotar/multichunk.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"> 9</span>
<span class="normal">10</span>
<span class="normal">11</span>
<span class="normal">12</span>
<span class="normal">13</span>
<span class="normal">14</span>
<span class="normal">15</span>
<span class="normal">16</span>
<span class="normal">17</span>
<span class="normal">18</span>
<span class="normal">19</span>
<span class="normal">20</span>
<span class="normal">21</span>
<span class="normal">22</span>
<span class="normal">23</span>
<span class="normal">24</span>
<span class="normal">25</span>
<span class="normal">26</span>
<span class="normal">27</span>
<span class="normal">28</span>
<span class="normal">29</span>
<span class="normal">30</span>
<span class="normal">31</span>
<span class="normal">32</span>
<span class="normal">33</span>
<span class="normal">34</span>
<span class="normal">35</span>
<span class="normal">36</span>
<span class="normal">37</span>
<span class="normal">38</span>
<span class="normal">39</span>
<span class="normal">40</span>
<span class="normal">41</span>
<span class="normal">42</span>
<span class="normal">43</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span>
    <span class="bp">self</span><span class="p">,</span>
    <span class="n">df</span><span class="p">,</span>
    <span class="n">file2</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
    <span class="n">CLEANUP</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
    <span class="n">coord_cols</span><span class="o">=</span><span class="p">[</span><span class="s2">&quot;Coord1&quot;</span><span class="p">,</span> <span class="s2">&quot;Coord2&quot;</span><span class="p">,</span> <span class="s2">&quot;Coord3&quot;</span><span class="p">,</span> <span class="s2">&quot;coord&quot;</span><span class="p">],</span>
    <span class="n">centred</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span>
    <span class="n">centered</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
    <span class="o">**</span><span class="n">kwargs</span><span class="p">,</span>
<span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;thermo_file - string of log file location&quot;&quot;&quot;</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">data</span><span class="p">:</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span> <span class="o">=</span> <span class="n">df</span>

    <span class="c1"># clean up dataframe</span>

    <span class="c1"># apply strip_pref function to remove &#39;c_/f_/v_&#39; prefixes to all columns</span>
    <span class="k">if</span> <span class="n">CLEANUP</span><span class="p">:</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">data</span><span class="o">.</span><span class="n">rename</span><span class="p">(</span><span class="n">columns</span><span class="o">=</span><span class="n">lmp_utils</span><span class="o">.</span><span class="n">strip_pref</span><span class="p">,</span> <span class="n">inplace</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">data</span><span class="o">.</span><span class="n">rename</span><span class="p">(</span><span class="n">columns</span><span class="o">=</span><span class="n">lmp_utils</span><span class="o">.</span><span class="n">drop_python_bad</span><span class="p">,</span> <span class="n">inplace</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
        <span class="c1"># todo merge columns into vectors</span>

    <span class="c1"># set the columns as attributes</span>
    <span class="k">for</span> <span class="n">col</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">data</span><span class="o">.</span><span class="n">columns</span><span class="p">:</span>
        <span class="c1"># setattr(self, col ,getattr(self.data, col))</span>
        <span class="c1"># has to be set to a method of the class</span>
        <span class="nb">setattr</span><span class="p">(</span>
            <span class="bp">self</span><span class="o">.</span><span class="vm">__class__</span><span class="p">,</span> <span class="n">col</span><span class="p">,</span> <span class="n">df_utils</span><span class="o">.</span><span class="n">raise_col</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">col</span><span class="p">)</span>
        <span class="p">)</span>  <span class="c1"># set attribute to this property object??</span>
    <span class="c1"># column names for the coordinates, up to 3</span>
    <span class="c1"># only those in the df are included, by finding intersect of sets.</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">coord_cols</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span><span class="nb">set</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">data</span><span class="o">.</span><span class="n">columns</span><span class="o">.</span><span class="n">to_list</span><span class="p">())</span> <span class="o">&amp;</span> <span class="nb">set</span><span class="p">(</span><span class="n">coord_cols</span><span class="p">))</span>
    <span class="k">if</span> <span class="n">centered</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
        <span class="n">centred</span> <span class="o">=</span> <span class="n">centered</span>

    <span class="bp">self</span><span class="o">.</span><span class="n">centred</span> <span class="o">=</span> <span class="n">centred</span>  <span class="c1"># Initialise assuming asymmetrical - to do implement a method to check this!!!!</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h2 id="thermotar.multichunk.MultiChunk.thersh_to_nan_return" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">thersh_to_nan_return</span><span class="p">(</span><span class="n">col</span><span class="p">,</span> <span class="n">thresh</span><span class="o">=</span><span class="mf">0.0</span><span class="p">)</span></code>

</h2>


    <div class="doc doc-contents ">

      <p>Replace values below a threshold with Nan
In columns col(ums)
Improves averages
Returns a new object</p>

            <details class="quote">
              <summary>Source code in <code>thermotar/multichunk.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"> 98</span>
<span class="normal"> 99</span>
<span class="normal">100</span>
<span class="normal">101</span>
<span class="normal">102</span>
<span class="normal">103</span>
<span class="normal">104</span>
<span class="normal">105</span>
<span class="normal">106</span>
<span class="normal">107</span>
<span class="normal">108</span>
<span class="normal">109</span>
<span class="normal">110</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span> <span class="nf">thersh_to_nan_return</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">col</span><span class="p">,</span> <span class="n">thresh</span><span class="o">=</span><span class="mf">0.0</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Replace values below a threshold with Nan</span>
<span class="sd">    In columns col(ums)</span>
<span class="sd">    Improves averages</span>
<span class="sd">    Returns a new object</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="c1"># TODO use views or something instead, idk</span>
    <span class="c1"># TODO create a clone method for chunk/multichunk/ for the the &quot;DataHolder&quot; class...</span>
    <span class="n">new_chunk</span> <span class="o">=</span> <span class="n">MultiChunk</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">data</span><span class="o">.</span><span class="n">copy</span><span class="p">())</span>
    <span class="n">new_chunk</span><span class="o">.</span><span class="n">thresh_to_nan_inplace</span><span class="p">(</span><span class="n">col</span><span class="o">=</span><span class="n">col</span><span class="p">,</span> <span class="n">thresh</span><span class="o">=</span><span class="n">thresh</span><span class="p">)</span>

    <span class="k">return</span> <span class="n">new_chunk</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h2 id="thermotar.multichunk.MultiChunk.thresh_to_nan_inplace" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">thresh_to_nan_inplace</span><span class="p">(</span><span class="n">col</span><span class="p">,</span> <span class="n">thresh</span><span class="o">=</span><span class="mf">0.0</span><span class="p">)</span></code>

</h2>


    <div class="doc doc-contents ">

      <p>Replace values below a threshold with Nan
In columns col
Improves averages</p>
<p>TODO actually implement what this says, not just removing the rows.....</p>

            <details class="quote">
              <summary>Source code in <code>thermotar/multichunk.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">82</span>
<span class="normal">83</span>
<span class="normal">84</span>
<span class="normal">85</span>
<span class="normal">86</span>
<span class="normal">87</span>
<span class="normal">88</span>
<span class="normal">89</span>
<span class="normal">90</span>
<span class="normal">91</span>
<span class="normal">92</span>
<span class="normal">93</span>
<span class="normal">94</span>
<span class="normal">95</span>
<span class="normal">96</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span> <span class="nf">thresh_to_nan_inplace</span><span class="p">(</span>
    <span class="bp">self</span><span class="p">,</span>
    <span class="n">col</span><span class="p">,</span>
    <span class="n">thresh</span><span class="o">=</span><span class="mf">0.0</span><span class="p">,</span>
<span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Replace values below a threshold with Nan</span>
<span class="sd">    In columns col</span>
<span class="sd">    Improves averages</span>

<span class="sd">    TODO actually implement what this says, not just removing the rows.....</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">df</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">data</span>

    <span class="bp">self</span><span class="o">.</span><span class="n">data</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">data</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="n">df</span><span class="p">[</span><span class="n">col</span><span class="p">]</span> <span class="o">&gt;=</span> <span class="n">thresh</span><span class="p">]</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h2 id="thermotar.multichunk.MultiChunk.zero_to_nan" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">zero_to_nan</span><span class="p">(</span><span class="n">val</span><span class="o">=</span><span class="mf">0.0</span><span class="p">,</span> <span class="n">col</span><span class="o">=</span><span class="kc">None</span><span class="p">)</span></code>

</h2>


    <div class="doc doc-contents ">

      <p>Replace an exact value specified by val with nan
In columns col
Improves averages</p>

            <details class="quote">
              <summary>Source code in <code>thermotar/multichunk.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">51</span>
<span class="normal">52</span>
<span class="normal">53</span>
<span class="normal">54</span>
<span class="normal">55</span>
<span class="normal">56</span>
<span class="normal">57</span>
<span class="normal">58</span>
<span class="normal">59</span>
<span class="normal">60</span>
<span class="normal">61</span>
<span class="normal">62</span>
<span class="normal">63</span>
<span class="normal">64</span>
<span class="normal">65</span>
<span class="normal">66</span>
<span class="normal">67</span>
<span class="normal">68</span>
<span class="normal">69</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span> <span class="nf">zero_to_nan</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">val</span><span class="o">=</span><span class="mf">0.0</span><span class="p">,</span> <span class="n">col</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Replace an exact value specified by val with nan</span>
<span class="sd">    In columns col</span>
<span class="sd">    Improves averages</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">if</span> <span class="n">col</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
        <span class="n">to_replace</span> <span class="o">=</span> <span class="p">{</span><span class="n">val</span><span class="p">:</span> <span class="n">np</span><span class="o">.</span><span class="n">nan</span><span class="p">}</span>
        <span class="n">value</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">nan</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">data</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">data</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="n">to_replace</span><span class="o">=</span><span class="n">to_replace</span><span class="p">)</span>
        <span class="k">return</span>
        <span class="c1"># self.data = self.data.replace(to_replace=)</span>
    <span class="k">elif</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">col</span><span class="p">,</span> <span class="nb">list</span><span class="p">):</span>
        <span class="n">to_replace</span> <span class="o">=</span> <span class="p">{</span><span class="n">column</span><span class="p">:</span> <span class="n">val</span> <span class="k">for</span> <span class="n">column</span> <span class="ow">in</span> <span class="n">col</span><span class="p">}</span>
        <span class="n">value</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">nan</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="n">to_replace</span> <span class="o">=</span> <span class="p">{</span><span class="n">col</span><span class="p">:</span> <span class="n">val</span><span class="p">}</span>
        <span class="n">value</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">nan</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">data</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">data</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="n">to_replace</span><span class="o">=</span><span class="n">to_replace</span><span class="p">,</span> <span class="n">value</span><span class="o">=</span><span class="n">value</span><span class="p">)</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h2 id="thermotar.multichunk.MultiChunk.zero_to_nan_return" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">zero_to_nan_return</span><span class="p">(</span><span class="n">val</span><span class="o">=</span><span class="mf">0.0</span><span class="p">,</span> <span class="n">col</span><span class="o">=</span><span class="kc">None</span><span class="p">)</span></code>

</h2>


    <div class="doc doc-contents ">

      <p>Replace an exact value specified by val with nan
In columns col
Improves averages
Same as zero_to_nan but creates a new obj</p>

            <details class="quote">
              <summary>Source code in <code>thermotar/multichunk.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">112</span>
<span class="normal">113</span>
<span class="normal">114</span>
<span class="normal">115</span>
<span class="normal">116</span>
<span class="normal">117</span>
<span class="normal">118</span>
<span class="normal">119</span>
<span class="normal">120</span>
<span class="normal">121</span>
<span class="normal">122</span>
<span class="normal">123</span>
<span class="normal">124</span>
<span class="normal">125</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span> <span class="nf">zero_to_nan_return</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">val</span><span class="o">=</span><span class="mf">0.0</span><span class="p">,</span> <span class="n">col</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Replace an exact value specified by val with nan</span>
<span class="sd">    In columns col</span>
<span class="sd">    Improves averages</span>
<span class="sd">    Same as zero_to_nan but creates a new obj</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">if</span> <span class="n">col</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
        <span class="c1"># apply to all cols</span>
        <span class="k">return</span> <span class="n">MultiChunk</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">data</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="n">to_replace</span><span class="o">=</span><span class="p">{</span><span class="n">val</span><span class="p">:</span> <span class="n">np</span><span class="o">.</span><span class="n">nan</span><span class="p">})</span><span class="o">.</span><span class="n">copy</span><span class="p">())</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="k">return</span> <span class="n">MultiChunk</span><span class="p">(</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">data</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="n">to_replace</span><span class="o">=</span><span class="p">{</span><span class="n">col</span><span class="p">:</span> <span class="n">val</span><span class="p">},</span> <span class="n">value</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">nan</span><span class="p">)</span><span class="o">.</span><span class="n">copy</span><span class="p">()</span>
        <span class="p">)</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>



  </div>

    </div>

</div>












                
              </article>
            </div>
          
          
<script>var target=document.getElementById(location.hash.slice(1));target&&target.name&&(target.checked=target.name.startsWith("__tabbed_"))</script>
        </div>
        
      </main>
      
        <footer class="md-footer">
  
  <div class="md-footer-meta md-typeset">
    <div class="md-footer-meta__inner md-grid">
      <div class="md-copyright">
  
  
    Made with
    <a href="https://squidfunk.github.io/mkdocs-material/" target="_blank" rel="noopener">
      Material for MkDocs
    </a>
  
</div>
      
    </div>
  </div>
</footer>
      
    </div>
    <div class="md-dialog" data-md-component="dialog">
      <div class="md-dialog__inner md-typeset"></div>
    </div>
    
    
    <script id="__config" type="application/json">{"base": "../..", "features": [], "search": "../../assets/javascripts/workers/search.b8dbb3d2.min.js", "translations": {"clipboard.copied": "Copied to clipboard", "clipboard.copy": "Copy to clipboard", "search.result.more.one": "1 more on this page", "search.result.more.other": "# more on this page", "search.result.none": "No matching documents", "search.result.one": "1 matching document", "search.result.other": "# matching documents", "search.result.placeholder": "Type to start searching", "search.result.term.missing": "Missing", "select.version": "Select version"}}</script>
    
    
      <script src="../../assets/javascripts/bundle.fe8b6f2b.min.js"></script>
      
    
  </body>
</html>